<script>
	require(["jquery", "layer"], function(){
		
	$(document).off("click.btn_login").on("click", "a[name='btn-login']", function(e){
		e.stopPropagation();
		$.get(Global.webPath + "/user_dialog_login.htm", function(x){
			layer.open({
			    type: 1,
				title : "",	
				content : x
			});
		});
	});
	$(document).off("click.confirm_cart").on("click.confirm_cart", "a[name='confirm-cart']", confirm_cart);
	$(document).off("click.hidegift").on("click.hidegift", "a[hidegift]", function(){
		$($(this).attr("hidegift")).hide();
	});
	$(document).off("click.gift_remove").on("click.gift_remove", "a[name='gift-remove']", function(){
		 $(this).parent().parent().remove();
	});
	$(document).off("click.hide_combin_other").on("click.hide_combin_other", "[name='hide-combin-other']", function(){
		$('div[id^=combin_other]').hide();
	});
	$(document).off("click.more_cart_remove").on("click.more_cart_remove", "a[name='more-cart-remove']", more_big_cart_remove);
	$(document).off("click.gift_tier_confirm").on("click.gift_tier_confirm", "input[name='gift-tier-confirm']", function(){
		gift_tier_confirm($(this).attr("giftid"));
	});
  function gift_tier_confirm(arg){
	  var size = $("#gift_inner_"+arg).find(":input:checked").length
	 	if(size==0){
		   layer.alert("请选择一件赠品！", {
			icon : "7",
			time : 3000
		});
		}
		if(size>1){
		   layer.alert("只能选择一件赠品！", {
				icon : "7",
				time : 3000
			});
		}
		if(size==1){
		 	var value = $("#gift_inner_"+arg).find(":input:checked").val();
			var name = $("#gift_inner_"+arg).find(":input:checked").attr("goods_name");
			var cart_id = $("#gift_inner_"+arg).find(":input:checked").attr("cart_id");
			$(".gift_list").remove();
			$("#gift_header_"+arg).append("<div class='gift_list' id='gift_list_"+value+"' mark='"+arg+"' gogi='"+value+"'>赠品："+name+" x1<span><a href='javascript:void(0);' name='gift-remove'>删除</a></span></div>");
			$("#gift_inner_"+arg).hide();
		}
	  }
  $(document).off("click.gifttier").on("click.gifttier", "a[gifttier]", function(){
  	gift_tier_show($(this).attr("gifttier"));
  });
  function gift_tier_show(arg){
		$("#gift_inner_"+arg).show();	  
	  }
  $(document).off("click.gift_tier_hide").on("click.gift_tier_hide", "input[name='gift-tier-hide']", function(){
  	gift_tier_hide($(this).attr("gifttier"));
  });
  function gift_tier_hide(arg){
		$("#gift_inner_"+arg).hide();	  
	  }
  function goods_count_adjust(gc_id,count,gift_id){
	  var gcs="";
	  $(":checkbox[id=id]:checked").each(function(){
		   var id=$(this).val();
		   gcs=id+","+gcs;
	  });
	  if(gcs==""){
	     gcs="-1";//为了和顶部的购物车计算总价区分开，如果gcs为空则会计算购物车所有商品总价，为-1则不会计算任何物品
	  }
   	  $.post(Global.webPath + "/goods_count_adjust.htm",{"gc_id":gc_id,"count":count,"gcs":gcs,"gift_id":gift_id},function(data){
		 if(data.code=="100"){																										
	       $("#goods_count_"+gc_id).val(data.count);
		   $("#goods_count_"+gc_id).attr("goods_count",data.count)
		   $("#gc_price"+gc_id).html("¥"+data.gc_price);
		   $("#total_price").html("¥"+data.total_price);
		   if(data.enough_reduce_price>0)
		   	$("#enough_reduce_money").show();
		   else
			$("#enough_reduce_money").hide();
		   $("#before_price").html("¥"+data.before);
		   $("#reduce_price").html("¥"+data.enough_reduce_price);
		   $("#top_total_price").html(data.all_price);		   
		   $("#select_gift_"+gift_id).hide();
		   $("div[id^=gift_inner_]").hide();
		   if(data.bg_ids!=undefined){
		    $.each(data.bg_ids,function(n,value){
			$("#select_gift_"+value).show();
			if($("#gift_inner_"+value).is(":hidden") == false){
				$("#gift_inner_"+value).show();
														   }
			 });
			$("div[id^=gift_list_]").each(function(){
				if(data.bg_ids.indexOf($(this).attr("mark"))==-1){
					$(this).remove();					
																	  }											
														});
			}
			if(data.bg_ids!=undefined&&gift_id==undefined){
				$("div[id^=gift_list_]").remove();
				}
		   #foreach($obj in ${er_goods.keySet()})
		   if(data.erString$!obj){
		   var erstr=data.erString$!obj;
		   $("#erString$!obj").html(""+data.erString$!obj);		   
		   }else{
		   $("#erString$!obj").html("$!erString.get($!obj)");	
		   }
		   #end
		 }
		 if(data.code=="200"){
		   $("#msg_info").remove(); 
		   $("#goods_count_"+gc_id).val(data.count);
		   $("#total_price").html("¥"+data.total_price);
		 }
		 if(data.code=="300"){
			$("#msg_info").remove();  
		   $("#goods_count_"+gc_id).val(data.count);
		   $("#total_price").html("¥"+data.total_price);
		 }
	   },"json");
  }

  function confirm_cart(){
	  var carts_size = $(":checkbox[id=id]:checked").length;
	  var gift_size = $("div[id^=gift_list_]").length;
	 if(carts_size>0){
		   var gcs="",counts="";
		  $(":checkbox[id=id]:checked").each(function(){
			   var id=$(this).val();
			   var count=$("#goods_count_"+id).val();
			   counts =  count + "," + counts;
			   gcs=id+","+gcs;
		  });
		  if(gift_size>0){
			   var gids="";
			  $("div[id^=gift_list_]").each(function(){
			   var gid=$(this).attr("gogi");
			   gids=gid+","+gids;
		 		 });
			  $("#giftids").val(gids);
			  }
		  $("#gcs").val(gcs);
		  
		  //结算校验库存，把库存不足的选中项去掉
		  /* $.post(Global.webPath + "/goods_adjust.htm",{"gcs":gcs, "counts":counts},function(data){
			  var k = 0;
			  for(var i in data.codes){
				  if(data.codes[i] == "200"){
					  $("[value="+data.gc_ids[i]+"]").prop("checked",false);
					  k++;
				  }
			  }
			  var cartsSize = $(":checkbox[id=id]:checked").length;
			    if(cartsSize<=0){
				 	$("span.go_count a").css("background","#999");
				 	$(":checkbox").prop("checked",false);
				}else{
			        $("span.go_count a").css("background","#ef2185");
			     }
			  if(k == 0){ */
				  $("#cart_form").submit(); 
			  /* }else{
				  
					  layer.alert("库存不足，请重新选择数量", {
					icon : "7",
					time : 3000
				});
			  } 
		  },"json");*/
		} 
  }  

$(document).off("click.favorite").on("click.favorite", "a[id^=favorite_]", function(e){
  e.stopPropagation();
  #if($!user)
    var user_id=$(this).attr("user_id");
    if(user_id=="$!{user.id}"){
	  
	  layer.alert("不能收藏自己的商品", {
				icon : "7",
				time : 3000
			});
	}else{
	  var id=$(this).attr("id").substring(9);
	  $.post(Global.webPath + "/add_goods_favorite.htm",{"id":id},function(data){
		 if(data==0){
		    
		    layer.alert("商品收藏成功!", {
				icon : "1",
				time : 3000
			});
		 }
		 if(data==1){
		    layer.alert("您已经收藏过该商品!", {
				icon : "7",
				time : 3000
			});
		 }
	  },"text");
	}
  #else
  	layer.confirm("登录后才可收藏商品，现在登录？", function(){
  		window.location.href=Global.webPath + "/user/login.htm?url="+ Global.webPath +  +"/goods_cart1.htm"
  	});
   
     
  #end
  });								
								
//								
  $(document).off("click.count_down").on("click.count_down", "a[id^=count_down]", function(){
	var gc_id=$(this).attr("gc_id");
	var count=$("#goods_count_"+gc_id).val();
	var f_sale_type=parseInt($(this).attr("f_sale_type"));
	var gift_id=$(this).attr("check_gift_id");	
	if(f_sale_type==0){
	  if(count>1){
	    count--;
	    $("#goods_count_"+gc_id).val(count);
        goods_count_adjust(gc_id,count,gift_id);
	  }
	}else{
	  $("#msg_info").remove();	
	  
	  layer.alert("F码商品一次只能购买一件!", {
				icon : "7",
				time : 3000
			});
	}
  });
  $(document).off("click.count_up").on("click.count_up", "a[id^=count_up]", function(){
	var gc_id=$(this).attr("gc_id");
	var count=$("#goods_count_"+gc_id).val();
	var f_sale_type=parseInt($(this).attr("f_sale_type"));
	var gift_id=$(this).attr("check_gift_id");	
	if(f_sale_type==0){
	    count++;
	    $("#goods_count_"+gc_id).val(count);
	    goods_count_adjust(gc_id,count,gift_id);
	 }else{
	  $("#msg_info").remove();	 
	  
	  layer.alert("F码商品一次只能购买一件!", {
				icon : "7",
				time : 3000
			});
	}
  });
  $(document).off("keyup.goods_count").on("keyup.goods_count", "input[id^=goods_count_]", function(){
	var gc_id=$(this).attr("gc_id");	
	var count=$("#goods_count_"+gc_id).val().replace(/\D/g,'');
	var f_sale_type=parseInt($(this).attr("f_sale_type"));
	var gift_id=$(this).attr("check_gift_id");	
	if(count==""){
       count=1;
	}	
	if(f_sale_type==0){
	  if(count>0){
	    goods_count_adjust(gc_id,count,gift_id);
	  }
	  if(count==0){
		$("#goods_count_"+gc_id).val("1");
		goods_count_adjust(gc_id,1,gift_id);
	  }
	}else{
	 $("#msg_info").remove();	 	
	 layer.alert("F码商品一次只能购买一件!", {
				icon : "7",
				time : 3000
			});
	 $("#goods_count_"+gc_id).val("1");
	}
  });
  //
  $(":checkbox[id=id]").click(function(){
	var carts_size = $(":checkbox[id=id]:checked").length;
	    if(carts_size<=0){
		 $("span.go_count a").css("background","#999");
		}else{
	        $("span.go_count a").css("background","#ef2185");
	     }										
     var val=$(this).prop("checked");
	 var gift_id=$(this).attr("check_gift_id");	
	 if(val){
        $(this).parent().parent().parent().addClass("this");
		var gc_id=$(this).val();
		var count=$("#goods_count_"+gc_id).val();
		goods_count_adjust(gc_id,count,gift_id);
	 }else{
	    $(this).parent().parent().parent().removeClass("this");
		var gc_id=$(":checkbox[id=id]:checked:first").val();
	    var count=$("#goods_count_"+gc_id).val();
	    goods_count_adjust(gc_id,count,gift_id);
	 }
  });
  //
  $(":checkbox[id=ids]").click(function(){
    var val=$(this).prop("checked");
	var value = $(this).val();
	if(val){
	  $(":checkbox[id=id]").prop("checked","checked");
	  $(":checkbox[value="+value+"]").prop("checked","checked");
	  $(".shopping_table tr").addClass("this");
	  var gc_id=$(":checkbox[id=id]:first").val();
	  var count=$("#goods_count_"+gc_id).val();
	  $(":checkbox[check_gift_id]").each(function(){
		  var gift_id = $(this).attr("check_gift_id");
	  	  goods_count_adjust(gc_id,count,gift_id);
	  });	
	  goods_count_adjust(gc_id,count,"mul");
	}else{
      $(":checkbox[id=id]").prop("checked",false);
	  $(":checkbox[value="+value+"]").prop("checked",false);
	  $(".shopping_table tr").removeClass("this");
	  $("#total_price").html("¥0.00");
	  $("#enough_reduce_money").hide();
	  $("a[id^=select_gift_]").hide();
	  $("div[id^=gift_inner_]").hide();
	  $("div[id^=gift_list_]").remove();
	  #if($!er_goods)
          #foreach($param in ${er_goods.keySet()})
		  $("#erString$!param").html("$!erString.get($param)");
		  #end
	  #end
	}
	var carts_size = $(":checkbox[id=id]:checked").length;
	    if(carts_size<=0){
		 $("span.go_count a").css("background","#999");
		}else{
		  $("span.go_count a").css("background","#ef2185");
	   }
  });
  //打开页面清除所有商品选择
  $(":checkbox").prop("checked",false);
  $("span.go_count a").css("background","#999");  
  #if($!user)
  $("span.go_count a").hover(					  
 	function(){
	 var carts_size = $(":checkbox[id=id]:checked").length;
	  if(carts_size<=0){
		  $(this).css({cursor:"url("+ Global.webPath + "/resources/style/common/images/refuse.cur),auto"})
		}else{
		  $(this).css("cursor","pointer");
	     }
	 },
	 function(){
	 $(this).css({cursor:"url(),auto"}
	)
 })
  #end 
    $("div[id^=gift_inner_]").find("input").each(function(){                                           
       $(this).click(function(){  
        var test= $(this).prop("checked");    
        if(this.checked){  
         $(this).parent().parent().parent().siblings().removeClass("this").find("input").prop("checked",false);  
		 $(this).parent().parent().parent().addClass("this");
        }     
       });  
      });  
   $(".standard_td").hover(function(){
		$(this).find("b").show();								 
		},function(){
			$(this).find("b").hide();		
			});
//去结算横条浮动   
	/*去掉针对结算的滚动
	$(window).scroll(function(){
        var holder = $("#shopping_operate"),
            elHeight = holder.height(),
            elWidth = holder.width(),
            oTop = holder.offset().top;
        function scrollBar() {
    		var dTop = $(document).scrollTop(),
    			wHeight = $(window).height();
    		if (dTop < (oTop - wHeight + elHeight)) {
    			holder.css({
    				height: elHeight,
    				width: elWidth
    			}).addClass('over_buy_button');
    		} else {
    			holder.removeClass('over_buy_button');
    		}
    	}
        scrollBar();
    	$(window).unbind('scroll').bind('scroll', scrollBar);   
	});
	*/

function more_big_cart_remove(){
	  	  var gcs="";
		  $(":checkbox[id=id]:checked").each(function(){
			   var id=$(this).val();
			   var data_bind=$(this).attr("data_bind");
			  	 if(data_bind!=""&&data_bind!=undefined){
				    gcs=data_bind+","+gcs;
				   }else{
					gcs=id+","+gcs;   
					   }
		 	 });
			  if(gcs!=""){
				  big_cart_remove(gcs);		
				}else{
				  	
				  layer.alert("至少选中一条数据！", {
				icon : "7",
				time : 3000
			});
				}	  
	}
	$(document).off("click.cartids").on("click.cartids", "a[cartids]", function(){
		var ids = $(this).attr("cartids");
		var type = $(this).attr("carttype");
		big_cart_remove(ids, type);
	});
function big_cart_remove(ids){
			var type=arguments[1];
      			var method = function(){
					   $.post(Global.webPath + "/remove_goods_cart.htm",{"ids":ids},function(data){
							if(type=="one_combin"){
								window.location.href=Global.webPath + "/goods_cart1.htm";
							}else{
								  if(data.code=="100"){
									$.each(data.ids, function(index,remove_id){
										if(remove_id.indexOf("combin")<0){
											$("table.shopping_table tr[id="+remove_id+"]").remove();
											}else{
											$("table.shopping_table tr[data_bind="+remove_id+"]").remove();	
												}						   
									});
									 $("tr[id^=tr_]").each(function(){
				 						var mark = $(this).attr("mark");
									if($("tr[mark=if_size_"+mark+"]").size()==0){
									$(this).remove();					
															     }											
														});
									 if(data.count==0){
										$("form[name='cart_form']").remove();
										$(".shopping_car_none").show();
										}	
									  }
									    		//计算购物车价钱
											goods_count_adjust();
									 if(data.code=="200"){	
									   layer.alert("系统繁忙，请稍后重试！", {
											icon : "7",
											time : 3000
										});
									 }
								}																		  
						 },"json");
					};
			if(type=="one_combin"){
				layer.confirm("删除后其他套装商品将不享受优惠！", function(){
					method();
					layer.closeAll();
				});
			}
			if(type=="all_combin"){
				layer.confirm("确定删除整个组合套装吗？", function(){
					method();
					layer.closeAll();
				});
			}
			 if(type=="" || type==undefined){
				layer.confirm("确定删除已选中的商品？", function(){
					method();
					layer.closeAll();
				});
			}
       }
function change_spec(obj){
	var obj_id = $(obj).attr("obj_id");
	var div =$("#standard_"+obj_id);
		$("div[id^=standard_]").hide();
		var obj_img = $(obj).attr("obj_img");
		$.post(Global.webPath + "/goods_cart1_spec.htm",{
			"cart_id":obj_id
			},function(data){
				$(div).find(".standard_left").html(data);
				$(div).show().find(".standard_right img").attr("src",obj_img);
				},"text");
	}
$(document).off("click.changespec").on("click.changespec", "a[name='changespec']", function(){
	change_spec(this);
});



});
</script>
<style>
.cart_common{ margin-left:57px;}
</style>
<div id="carts_list"> #if($!cart.size()>0||$!ac_goods||$!er_goods)
  <form  method="post"  name="cart_form" target="_self" id="cart_form" action="$!webPath/goods_cart2.htm">
    <input type="hidden" name="giftids" id="giftids" value="" />
    <div class="shopping_list">
      <div class="shopping_h">
        <h1 style="font-size:16px;">我的购物车</h1>
        <span class="hbuy_l" style="font-size:14px"></span> </div>
      <table width="1200" border="0" cellpadding="0" cellspacing="0" class="shopping_table">
        <tr>
          <th align="left" > <span class="shopping_table_check">
            <label>
              <input name="ids" type="checkbox" value="-1" id="ids" />
              全选</label>
            </span></th>
          <th width="33%">商品名称</th>
          <th width="12%">规格</th>
          <th width="13%">单价</th>
          <th width="8%">数量</th>
          <th width="13%">小计(元)</th>
          <th>操作</th>
        </tr>
        #if($!cart.size()>0)
        <!--普通商品开始-->
        #foreach($obj in $cart)
        #set($img="$!{config.goodsImage.path}/$!{config.goodsImage.name}")
        #if($!obj.goods.goods_main_photo)               
        #set($img="$!{obj.goods.goods_main_photo.path}/$!{obj.goods.goods_main_photo.name}_small.$!{obj.goods.goods_main_photo.ext}")         
        #end
        
        #set($goods_url="$!webPath/goods_$!{obj.goods.id}.htm")
        #if($!config.second_domain_open && $!obj.goods.goods_type==1 && $!obj.goods.goods_store.store_second_domain!="")
        #set($goods_url="http://$!{obj.goods.goods_store.store_second_domain}.$!{domainPath}/goods_$!{obj.goods.id}.htm")
        #end
        <tr goods_list="goods_info_$!obj.id" id="$!obj.id" #if($!obj.goods.goods_store && $!{obj.goods.goods_store.store_status}!=15) class="no_goods" #end>          

          <td><span class="shopping_table_check1">
          	#if($!{obj.goods.goods_type}==0 || $!{obj.goods.goods_store.store_status}==15)
          	#if($!{obj.goods.goods_status}==0 || $!{obj.goods.goods_status}==2)
          	#if($!{obj.goods.seckill_buy}!=4)
            <input name="id" type="checkbox" mark="$!obj.cart_type" value="$!{obj.id}" id="id" />
            #end
            #end
            #end
            </span></td>
          <td><dl class="shopping_goods">
              <dt><a href="$!goods_url" target="_blank"><span class="img_cspan">
                <p><img src="$!{img}" width="60" height="60" /></p>
                </span></a></dt>
              <dd>
                <h5>
                	<a href="$!goods_url" target="_blank">$!obj.goods.goods_name </a> 
                	#if($!{obj.goods.group_buy}==2) 
                	<span style="color:#F00">(团购)</span> 
                	#end 
                	#if($!{obj.goods.seckill_buy}==2 || $!{obj.goods.seckill_buy}==4) 
                	<span style="color:#F00">(秒杀)</span> 
                	#end 
                	#if($!{obj.goods.activity_status}==2) 
                	<span style="color:#F00">(促销)</span> 
                	#end
                </h5>
                #if($!{obj.goods.goods_type}==1 && $!{obj.goods.goods_store.store_status}!=15)
                <span style="color:#F00"> 已失效</span>
          		#elseif($!{obj.goods.goods_status}!=0 && $!{obj.goods.goods_status}!=2)
          		<span style="color:#F00"> 已失效</span>
          		#elseif($!{obj.goods.seckill_buy}==4)
          		<span style="color:#F00"> 活动暂未开始</span>
               	#end
              </dd>
            </dl>
            
     		<!-- 商品图标start -->
             #if($!{obj.goods.goodsConfig.iconUrl})
                 <img src="$!webPath/$!{obj.goods.goodsConfig.iconUrl}" />
             #end
         	<!-- 商品图标end -->
            
            </td>
          <td align="center"><div #if($!obj.spec_info!="")class="standard_td" #end>#if($!obj.spec_info!="")$!{obj.spec_info}#else暂无#end
              <!--规格修改-->
              <div class="standard" id="standard_$!{obj.id}" style="display:none">
              <div class="standard_left"></div>
                <div class="standard_right"><img src="" width="150" height="150" /></div>
              </div>
              <!--规格修改-->
             #if($!obj.spec_info!="") <b style="display:none"><a href="javascript:void(0);" obj_img="$!{img}" obj_id="$!obj.id" name="changespec">修改</a></b> #end</div></td>
          <td align="center">¥$!obj.price</td>
          <td>
          	<span class="shop_count"> 
          		#if($!{obj.goods.seckill_buy}!=2 && $!{obj.goods.seckill_buy}!=4) 
          		<a  href="javascript:void(0);" id="count_down_$!obj.id" gc_id="$!obj.id" f_sale_type="$!obj.goods.f_sale_type" class="shop_cut"></a>
            	<input name="goods_count_$!{obj.id}" type="text" id="goods_count_$!{obj.id}" f_sale_type="$!obj.goods.f_sale_type" value="$!obj.count" gc_id="$!obj.id"  goods_count="$!obj.count" class="shop_num" />
            	<a href="javascript:void(0);" id="count_up_$!obj.id" gc_id="$!obj.id" f_sale_type="$!obj.goods.f_sale_type" class="shop_add"></a> 
            	#else
            	<span   class="shop_cut_blank"></span>
            	<input name="goods_count_$!{obj.id}" type="text" id="goods_count_$!{obj.id}" f_sale_type="$!obj.goods.f_sale_type" value="1" gc_id="$!obj.id"  goods_count="$!obj.count" class="shop_num" readonly="readonly"/>
            	<span  class="shop_add_blank"></span> 
            	#end
            </span>
          </td>
          #set($total_price=$!obj.count * $!obj.price)
          <td align="center"><strong class="shopping_result" id="gc_price$!{obj.id}">¥$!{total_price}</strong></td>
          <td  align="center"><a href="javascript:void(0);" user_id="$!obj.goods.goods_store.user.id" id="favorite_$!{obj.goods.id}" class="cart_common">收藏</a><a href="javascript:void(0);" cartids="$!obj.id" class="cart_common">删除</a></td>
        </tr>
        #end
        #end
        <!--普通商品结束-->
        <!--满就减活动开始-->
        #if($!er_goods)
        #foreach($param in ${er_goods.keySet()})
        <tr  id="tr_$!param" mark="$!param">
          <td colspan="7" style="padding:0px;"><div class="gift_header"> <span class="icon_j"></span> <span id="erString$!param">$!erString.get($param)</span><i><a href="$!webPath/enoughreduce/index_$!{param}.htm" target="_blank">更多活动商品</a></i> </div></td>
        </tr>
        #foreach($obj in ${er_goods.get($param)})
        #if($!obj.goods.goods_main_photo)               
        #set($img="$!{obj.goods.goods_main_photo.path}/$!{obj.goods.goods_main_photo.name}_small.$!{obj.goods.goods_main_photo.ext}")
        #else
        #set($img="$!{config.goodsImage.path}/$!{config.goodsImage.name}")
        #end
        
        #set($goods_url="$!webPath/goods_$!{obj.goods.id}.htm")
        #if($!config.second_domain_open && $!obj.goods.goods_type==1 && $!obj.goods.goods_store.store_second_domain!="")
        #set($goods_url="http://$!{obj.goods.goods_store.store_second_domain}.$!{domainPath}/goods_$!{obj.goods.id}.htm")
        #end
        <tr goods_list="goods_info_$!obj.id" id="$!obj.id" mark="if_size_$!param" #if($!obj.goods.goods_store && $!{obj.goods.goods_store.store_status}!=15) class="no_goods" #end>
          <td><span class="shopping_table_check1">
          	#if($!{obj.goods.goods_type}==0 || $!{obj.goods.goods_store.store_status}==15)
          	#if($!{obj.goods.goods_status}==0 || $!{obj.goods.goods_status}==2)
            <input name="id" type="checkbox" value="$!{obj.id}" id="id" />
            #end
            #end
            </span></td>
          <td><dl class="shopping_goods">
              <dt><a href="$!goods_url" target="_blank"><span class="img_cspan">
                <p><img src="$!{img}" width="60" height="60" /></p>
                </span></a></dt>
              <dd>
                <h5><a href="$!goods_url" target="_blank">$!obj.goods.goods_name </a> </h5>
                #if($!{obj.goods.goods_type}==1 && $!{obj.goods.goods_store.store_status}!=15)
                <span style="color:#F00"> 已失效</span>
          		#elseif($!{obj.goods.goods_status}!=0 && $!{obj.goods.goods_status}!=2)
          		<span style="color:#F00"> 已失效</span>
               	#end
              </dd>
            </dl>
            <!-- 商品图标start -->
             #if($!{obj.goods.goodsConfig.iconUrl})
                 <img src="$!webPath/$!{obj.goods.goodsConfig.iconUrl}" />
             #end
         	<!-- 商品图标end -->
            </td>
          <td align="center"><div #if($!obj.spec_info!="")class="standard_td" #end>#if($!obj.spec_info!="")$!{obj.spec_info}#else暂无#end
              <!--规格修改-->
              <div class="standard" id="standard_$!{obj.id}" style="display:none">
              <div class="standard_left"></div>
                <div class="standard_right"><img src="" width="150" height="150" /></div>
              </div>
              <!--规格修改-->
             #if($!obj.spec_info!="") <b style="display:none"><a href="javascript:void(0);" obj_img="$!{img}" obj_id="$!obj.id" name="changespec">修改</a></b> #end</div></td>
          <td align="center">¥$!obj.price</td>
          <td><span class="shop_count"><a  href="javascript:void(0);" id="count_down_$!obj.id" f_sale_type="$!obj.goods.f_sale_type" gc_id="$!obj.id"  class="shop_cut"></a>
            <input name="goods_count_$!{obj.id}" type="text" id="goods_count_$!{obj.id}" f_sale_type="$!obj.goods.f_sale_type" value="$!obj.count" gc_id="$!obj.id"  goods_count="$!obj.count" class="shop_num" />
            <a href="javascript:void(0);" id="count_up_$!obj.id" f_sale_type="$!obj.goods.f_sale_type" gc_id="$!obj.id" class="shop_add"></a></span></td>
          #set($total_price=$!obj.count * $!obj.price)
          <td align="center"><strong class="shopping_result" id="gc_price$!{obj.id}">¥$!{total_price}</strong></td>
          <td  align="center"><a href="javascript:void(0);" user_id="$!obj.goods.goods_store.user.id" id="favorite_$!{obj.goods.id}" class="cart_common">收藏</a><a href="javascript:void(0);" cartids="$!obj.id" class="cart_common">删除</a></td>
        </tr>
        #end
        #end
        #end
        <!--满就送活动开始-->
        #if($!ac_goods)
        #foreach($param in ${ac_goods.keySet()})
        #set($buyGift = $!goodsViewTools.query_buyGift("$!{param}"))
        <tr id="tr_$!buyGift.id" mark="$!buyGift.id" cart_id="$!obj.id">
          <td colspan="7" style="padding:0px;"><div class="gift_header" id="gift_header_$!buyGift.id"> <span class="icon"></span> <span>活动商品满$!buyGift.condition_amount元即有赠品相送。</span><i><a href="$!webPath/buygift/index_$!{buyGift.id}.htm"  target="_blank">更多活动商品</a></i> <span class="gift_btn"> <a class="gift_a" style="display:none" href="javascript:void(0);" gifttier="$!{buyGift.id}" id="select_gift_$!buyGift.id">选择赠品</a>
              <!-- 赠品展示 -->
              <div class="gift_tier" style="display:none" id="gift_inner_$!buyGift.id">
                <div class="gift_inner">
                  <h1><span class="fl">请选赠送商品，数量有限，赠完即止</span><a class="fr" hidegift="#gift_inner_$!buyGift.id"></a></h1>
                  <div class="gift_goods">
                    <ul>
                      #set($v_count=0)
                      #foreach($map in $!CommUtil.json2List("$!buyGift.gift_info"))
                      #set($storegoods_count = $!{map.get('storegoods_count')})	
                      #set($goods_id = "$!{map.get('goods_id')}")	
                      #set($enough=1)
                      #if($!storegoods_count==0)
                      #if($!{map.get('goods_count')}<=0)
                      #set($enough=0)
                      #end
                      #end
                      
                      #if($!storegoods_count==1)
                      #set($g = $!goodsViewTools.query_Goods("$!{goods_id}"))
                      #if($!g)
                      #if($!g.goods_inventory<=0)
                      #set($enough=0)
                      #end
                      #else
                      #set($enough=0)
                      #end
                      #end
                      
                      
                      #if($!enough==1)  
                      #set($goods_name = "$!{map.get('goods_name')}")
                      #set($goods_price = "$!{map.get('goods_price')}")
                      #set($goods_mainphoto_path = "$!{map.get('goods_main_photo')}")
                      #set($img="$!{goods_mainphoto_path}")
                      #set($goods_domainPath = "$!{map.get('goods_domainPath')}")
                      #set($v_count=$!v_count+1)
                      <li class="">
                        <dl>
                          <dt>
                            <input type="checkbox" value="$!goods_id" goods_name="$!goods_name" id="giftid"  />
                          </dt>
                          <dd class="img"><a href="$!goods_domainPath" target="_blank"><img src="$!img" /></a></dd>
                          <dd class="text"> <span><a href="$!goods_domainPath" target="_blank">$!goods_name</a></span> <span>原价：¥$!goods_price元 现价：¥0元</span> </dd>
                        </dl>
                      </li>
                      #end
                      #end
                      #if($!v_count==0)
                      <p style="padding-top:15px; text-align:center">暂无赠品</p>
                      #end
                    </ul>
                  </div>
                  <div class="gift_enter">
                    <input class="enter" type="button" value="确定" name="gift-tier-confirm" giftid="$!{buyGift.id}" />
                    <input class="cancel" type="button" value="取消" name="gift-tier-hide" giftid="$!{buyGift.id}" />
                  </div>
                </div>
                <div class="gift_bg"></div>
              </div>
              </span> </div>
            </td>
        </tr>
        #foreach($obj in ${ac_goods.get($param)})
        #if($!obj.goods.goods_main_photo)               
        #set($img="$!{obj.goods.goods_main_photo.path}/$!{obj.goods.goods_main_photo.name}_small.$!{obj.goods.goods_main_photo.ext}")
        #else
        #set($img="$!{config.goodsImage.path}/$!{config.goodsImage.name}")
        #end
        
        #set($goods_url="$!webPath/goods_$!{obj.goods.id}.htm")
        #if($!config.second_domain_open && $!obj.goods.goods_type==1 && $!obj.goods.goods_store.store_second_domain!="")
        #set($goods_url="http://$!{obj.goods.goods_store.store_second_domain}.$!{domainPath}/goods_$!{obj.goods.id}.htm")
        #end
        <tr goods_list="goods_info_$!obj.id" id="$!obj.id" mark="if_size_$!buyGift.id" #if($!obj.goods.goods_store && $!{obj.goods.goods_store.store_status}!=15) class="no_goods" #end>
          <td><span class="shopping_table_check1">
          	#if($!{obj.goods.goods_type}==0 || $!{obj.goods.goods_store.store_status}==15)
          	#if($!{obj.goods.goods_status}==0 || $!{obj.goods.goods_status}==2)
            <input name="id" type="checkbox" value="$!{obj.id}" id="id" check_gift_id="$!buyGift.id" />
            #end
            #end
            </span></td>
          <td><dl class="shopping_goods">
              <dt><a href="$!goods_url" target="_blank"><span class="img_cspan">
                <p><img src="$!{img}" width="60" height="60" /></p>
                </span></a></dt>
              <dd>
                <h5><a href="$!goods_url" target="_blank">$!obj.goods.goods_name </a>
                </h5>
                #if($!{obj.goods.goods_type}==1 && $!{obj.goods.goods_store.store_status}!=15)
                <span style="color:#F00"> 已失效</span>
          		#elseif($!{obj.goods.goods_status}!=0 && $!{obj.goods.goods_status}!=2)
          		<span style="color:#F00"> 已失效</span>
               	#end
              </dd>
            </dl>
          	<!-- 商品图标start -->
             #if($!{obj.goods.goodsConfig.iconUrl})
                 <img src="$!webPath/$!{obj.goods.goodsConfig.iconUrl}" />
             #end
         	<!-- 商品图标end -->  
          </td>
          <td align="center"><div #if($!obj.spec_info!="")class="standard_td" #end>#if($!obj.spec_info!="")$!{obj.spec_info}#else暂无#end
              <!--规格修改-->
              <div class="standard" id="standard_$!{obj.id}" style="display:none">
              <div class="standard_left"></div>
                <div class="standard_right"><img src="" width="150" height="150" /></div>
              </div>
              <!--规格修改-->
             #if($!obj.spec_info!="") <b style="display:none"><a href="javascript:void(0);" obj_img="$!{img}" obj_id="$!obj.id" name="changespec">修改</a></b> #end</div></td>
          <td align="center">¥$!obj.price</td>
          <td><span class="shop_count"><a  href="javascript:void(0);" f_sale_type="$!obj.goods.f_sale_type" id="count_down_$!obj.id" gc_id="$!obj.id"  class="shop_cut" check_gift_id="$!buyGift.id"></a>
            <input name="goods_count_$!{obj.id}" type="text" id="goods_count_$!{obj.id}"  f_sale_type="$!obj.goods.f_sale_type"  value="$!obj.count" gc_id="$!obj.id"  goods_count="$!obj.count" class="shop_num" check_gift_id="$!buyGift.id" />
            <a href="javascript:void(0);" id="count_up_$!obj.id" f_sale_type="$!obj.goods.f_sale_type" gc_id="$!obj.id" class="shop_add" check_gift_id="$!buyGift.id"></a></span></td>
          #set($total_price=$!obj.count * $!obj.price)
          <td align="center"><strong class="shopping_result" id="gc_price$!{obj.id}">¥$!{total_price}</strong></td>
          <td  align="center"><a href="javascript:void(0);" id="favorite_$!{obj.goods.id}" user_id="$!obj.goods.goods_store.user.id" class="cart_common">收藏</a><a href="javascript:void(0);" cartids="$!obj.id" class="cart_common">删除</a></td>
        </tr>
        #end
        #end
        #end
        <!--满就减活动结束-->
        <script>
        require(["jquery"], function($){
        	
        
        $(document).off("click.cart_detail_id").on("click.cart_detail_id", "a[cart-detail-id]", function(){
        	combin_carts_detail($(this).attr("cart-detail-id"));
        });
         function combin_carts_detail(id){
			 var div = $("div[id=combin_other_"+id+"]");
			 if(id!="" && id!=undefined){
			   var dis = $(div).css("display");
				   if(dis=="none"){
					   $(div).show();
					   $.post(Global.webPath + "/combin_carts_detail.htm",
								 {"id":id
									 },function(data){
										 if(data.code==100){
												 $(div).find("div[id='combin_other_content']").show();
												 $(div).find("ul[id='combin_ul']").html("");
												$.each(data.map_list,function(index,obj){
														var obj_id = obj.id;
														var obj_img = obj.img;
														var obj_name = obj.name;
														var obj_url = obj.url;
														var obj_price = obj.price;
														var obj_count = obj.count;
														var obj_spec_info = obj.spec_info;
														 $(div).find("ul[id='combin_ul']").append("<li><dl><dd class='img'><a href='"+obj_url+"' target='_blank'><img src='"+obj_img+"'/></a></dd><dd class='text'><span style='height:24px; overflow:hidden;'><a href='"+obj_url+"' target='_blank'>"+obj_name+"</a><br></span><span><span style='color:#666'>"+obj_spec_info+"</span></span></dd><dd style='padding-left:20px'><a style='color:#0a8db8' href='javascript:void(0);' cartids='"+ obj_id +"' carttype='one_combin'>删除</a></dd></dl></li>");  					  
												 });
											 }
											if(data.code==-100){
												 layer.alert("参数错误，请刷新页面！", {
														icon : "7",
														time : 3000
													});
												 }			  
											 },"json"); 
					   }
				 }else{
				 	
				 		layer.alert("参数错误，请刷新页面！", {
							icon : "7",
							time : 3000
						});
				 }
			 };
			 });
         </script>
        <!--组合套装活动开始-->
        #if($!combin_carts)
        #foreach($obj in $combin_carts)
        #if($!obj.combin_main==1)
        #set($suit_map=$!goodsViewTools.getSuitInfo("$!obj.id"))
        #end
        #if($!obj.goods.goods_main_photo)               
        #set($img="$!{obj.goods.goods_main_photo.path}/$!{obj.goods.goods_main_photo.name}_small.$!{obj.goods.goods_main_photo.ext}")
        #else
        #set($img="$!{config.goodsImage.path}/$!{config.goodsImage.name}")
        #end
        
        #set($goods_url="$!webPath/goods_$!{obj.goods.id}.htm")
        #if($!config.second_domain_open && $!obj.goods.goods_type==1 && $!obj.goods.goods_store.store_second_domain!="")
        #set($goods_url="http://$!{obj.goods.goods_store.store_second_domain}.$!{domainPath}/goods_$!{obj.goods.id}.htm")
        #end
        <tr data_bind="$!obj.combin_mark">
          <td colspan="7" style="padding-top:0; padding-bottom:0px;"><div class="gift_header group_car"> <span class="icon"></span> <span>$!{obj.combin_version}套装价格：¥$!{suit_map.get('plan_goods_price')}</span> <span class="gift_btn"> <a class="gift_a" href="javascript:void(0);" cart-detail-id="$!obj.id">组合明细</a>
              <div class="gift_tier" id="combin_other_$!{obj.id}" style="display:none">
                <div class="gift_loading" style="height:86px"><img src="$!webPath/resources/style/common/images/ajax_loader.gif"/></div>
                <div class="gift_inner" id="combin_other_content" style="display:none">
                  <h1><span class="fl" style="color:#F90">重要提示：删除任意套装内商品，其他商品不再享受套装优惠</span><a class="fr" name="hide-combin-other"></a></h1>
                  <div class="gift_goods" style="height:150px">
                    <ul id="combin_ul">
                    </ul>
                  </div>
                  <div class="gift_enter">
                    <input class="enter" type="button" value="关闭" name="hide-combin-other" />
                  </div>
                </div>
                <div class="gift_bg" style="height:247px"></div>
              </div>
              </span> </div></td>
        </tr>
        <tr goods_list="goods_info_$!obj.id" id="$!obj.id" data_bind="$!obj.combin_mark" #if($!obj.goods.goods_store && $!{obj.goods.goods_store.store_status}!=15) class="no_goods" #end>
          <td><span class="shopping_table_check1">
          #if($!{obj.goods.goods_type}==0 || $!{obj.goods.goods_store.store_status}==15)
          #if($!{obj.goods.goods_status}==0 || $!{obj.goods.goods_status}==2)
            <input name="id" type="checkbox" value="$!{obj.id}" id="id" data_bind="$!obj.combin_mark" />
          #end  
          #end  
            </span></td>
          <td><dl class="shopping_goods">
              <dt><a href="$!goods_url" target="_blank"><span class="img_cspan">
                <p><img src="$!{img}" width="60" height="60" /></p>
                </span></a></dt>
              <dd>
                <h5><a href="$!goods_url" target="_blank">$!obj.goods.goods_name </a></h5>
                #if($!{obj.goods.goods_type}==1 && $!{obj.goods.goods_store.store_status}!=15)
                <span style="color:#F00"> 已失效</span>
          		#elseif($!{obj.goods.goods_status}!=0 && $!{obj.goods.goods_status}!=2)
          		<span style="color:#F00"> 已失效</span>
               	#end
              </dd>
			  
            </dl>
          	<!-- 商品图标start -->
             #if($!{obj.goods.goodsConfig.iconUrl})
                 <img src="$!webPath/$!{obj.goods.goodsConfig.iconUrl}" />
             #end
         	<!-- 商品图标end -->
          </td>
          <td align="center"><div #if($!obj.spec_info!="")class="standard_td" #end>#if($!obj.spec_info!="")$!{obj.spec_info}#else暂无#end
         </div></td>
          <td align="center">¥$!{suit_map.get('plan_goods_price')}<br>
            <b style="color:#F00">（组合单价）</b></td>
          <td><span class="shop_count"> <a  href="javascript:void(0);" f_sale_type="$!obj.goods.f_sale_type" id="count_down_$!obj.id" gc_id="$!obj.id"  class="shop_cut"></a>
            <input name="goods_count_$!{obj.id}" type="text" id="goods_count_$!{obj.id}" f_sale_type="$!obj.goods.f_sale_type" value="$!obj.count" gc_id="$!obj.id"  goods_count="$!obj.count" class="shop_num" />
            <a href="javascript:void(0);" id="count_up_$!obj.id" f_sale_type="$!obj.goods.f_sale_type" gc_id="$!obj.id" class="shop_add"></a> </span></td>
          <td align="center"><strong class="shopping_result" id="gc_price$!{obj.id}">¥#if($!{suit_map.get('suit_all_price')})$!{suit_map.get('suit_all_price')}#else$!{suit_map.get('plan_goods_price')}#end</strong></td>
          <td  align="center"><a href="javascript:void(0);" user_id="$!obj.goods.goods_store.user.id" id="favorite_$!{obj.goods.id}" class="cart_common">收藏</a><a href="javascript:void(0);" cartids="$!obj.combin_mark" carttype="all_combin" class="cart_common">删除</a></td>
        </tr>
        #end 
        #end
        <!--组合套装活动结束-->
      </table>
    </div>
    <div id="show_money">
    <div class="shopping_operate" id="shopping_operate"> <span class="go_count"> <i style="height:45px; width:200px; float:left;">
      <ul style="display:none" id="enough_reduce_money">
        <li style="height:20px; margin-top:3px; width:200px;line-height:20px; float:left;">商品总计:<span id="before_price">0</span>元</li>
        <li style="height:20px; margin-top:3px; width:200px;line-height:20px; float:left;">满就减金额:<span id="reduce_price">0</span>元</li>
      </ul>
      </i> <b>商品总价（不含运费）：<strong id="total_price">¥0.00</strong>元</b><a href="javascript:void(0);"  #if(!$!user) name="btn-login"  #else name="confirm-cart" #end class="go_price">
      <input type="hidden" name="gcs" id="gcs" />
      去结算</a></span> <span class="shopping_operate_check">
      <label>
        <input name="ids" type="checkbox" value="-1" id="ids" />
        全选</label>
      </span><span class="shop_del_all"><a href="javascript:void(0);" name="more-cart-remove">批量删除</a></span><span class="shop_del_all"><a href="$!webPath/index.htm">继续购物</a></span></div>
     </div> 
  </form>
  #end
  <div class="shopping_car_none"  #if($!cart.size()>0||$!ac_goods||$!er_goods) style="display:none" #end>
    <div class="shopcar_none_box">
      <dl>
        <dt></dt>
        <dd>
          <h4>您的购物车还是空的，赶紧行动吧！</h4>
          <span class="none_box_sp">您可以<a href="$!webPath/buyer/order.htm">查看订单</a>，或者是<a href="$!webPath/index.htm">随便看看</a></span></dd>
      </dl>
    </div>
  </div>
</div>
#if(!$!load_class)
		<script>
			require(["jquery", "superslide"], function(){
				$(".shopping_other_list_center").slide({titCell:".shopping_other_list_button ul",mainCell:".shopping_other_list_center_box ul",autoPage:true,effect:"left",autoPlay:true,scroll:7,vis:7,trigger:"click"});
			});
      
      </script>
#if($!goodsViewTools.query_Ztc_Goods(21).size()>0)      
<div class="shopping_other">
  <div class="shopping_other_list_center">
    <div class="shopping_other_list_button">
      <div class="shopping_other_list_button_left">您可能还需要其他商品</div>
      <div class="shopping_other_list_button_right"> <a class="next"></a>
        <ul>
          <li></li>
        </ul>
        <a class="prev"></a> </div>
    </div>
    <div class="shopping_other_list_center_box">
      <div class="shopping_other_list_center_box_c">
        <ul>
          #foreach($goods in $!goodsViewTools.query_Ztc_Goods(21))
          #if($!goods.goods_main_photo)
          #set($small_img="$!{goods.goods_main_photo.path}/$!{goods.goods_main_photo.name}_small.$!{goods.goods_main_photo.ext}")
          #else
          #set($small_img="$!{config.goodsImage.path}/$!{config.goodsImage.name}")
          #end
          
          #set($goods_url="$!webPath/goods_$!{goods.id}.htm")
          #if($!config.second_domain_open && $!goods.goods_type==1 && $!goods.goods_store.store_second_domain!="")
          #set($goods_url="http://$!{goods.goods_store.store_second_domain}.$!{domainPath}/goods_$!{goods.id}.htm")
          #end
          <li><span><a href="$!goods_url" target="_blank"><img src="$!{small_img}" /></a></span><i><a href="$!goods_url" target="_blank">$!goods.goods_name</a></i><b>商城价：<strong>¥$!{goods.goods_current_price}</strong></b> <em class="shopping_other_list_center_box_buy"> #if($!user)
            #if($!goods.f_sale_type==1) <a style="margin:0 auto;" href="javascript:void(0);" goods_id="$!goods.id" goods_type="$!goods.goods_type" user_id="$!goods.goods_store.user.id"   id="f_goods_cart_$!{goods.id}">F码购买</a></a> #else <a style="margin:0 auto;" href="javascript:void(0);" goods_id="$!goods.id" goods_type="$!goods.goods_type" user_id="$!goods.goods_store.user.id" id="goods_cart_$!{goods.id}">加入购物车</a> #end
            #else
            #if($!goods.f_sale_type==1) <a style="margin:0 auto;" href="javascript:void(0);"name="btn-login">F码购买</a> #else <a style="margin:0 auto;" href="javascript:void(0);" goods_id="$!goods.id" goods_type="$!goods.goods_type" user_id="$!goods.goods_store.user.id" id="goods_cart_$!{goods.id}">加入购物车</a> #end
            #end </em> </li>
          #end
        </ul>
      </div>
    </div>
  </div>
</div>
#end
#end