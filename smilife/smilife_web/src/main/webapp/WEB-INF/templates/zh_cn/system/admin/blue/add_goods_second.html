<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>填写商品详细信息 - $!{config.poweredby}</title>
<link href="$!webPath/resources/style/system/manage/$!{config.websiteCss}/template.css"  rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="$!webPath/resources/editor/themes/default/default.css" />
<link href="$!webPath/resources/style/common/css/overlay.css" type="text/css" rel="stylesheet" />
<link  href="$!webPath/resources/style/common/css/jquery-ui-1.8.22.custom.css" type="text/css" rel="stylesheet">
<script src="$!webPath/resources/js/jquery-1.6.2.js"></script>
<script src="$!webPath/resources/js/jquery-ui-1.8.21.js"></script>
<script src="$!webPath/resources/js/jquery.zh.cn.js"  charset="utf-8"></script>
<script src="$!webPath/resources/js/jquery.shop.common.js"></script>
<script src="$!webPath/resources/js/jquery.shop.base.js"></script>
<script src="$!webPath/resources/js/jquery.validate.min.js"></script>
<script charset="utf-8" src="$!webPath/resources/editor/kindeditor-min.js"></script>
<script charset="utf-8" src="$!webPath/resources/editor/lang/zh_CN.js"></script>
<script src="$!webPath/resources/js/ajaxfileupload.js"></script>
<script>
jQuery.validator.addMethod("profix", function(value, element) {
    return /^[0-9a-zA-Z]{0,6}$/.test(value);
}, "前缀必须是6字之内字母数字的组合");
jQuery.validator.addMethod("advance_sale_type",
	    function(value, element) {
	        if (jQuery(':radio[id=advance_sale_type][value=1]').attr('checked')){
	        	if (jQuery('#advance_date').val() == ''){
	        		return false;
	        	}else{
	        		return true;
	        	}
	        }else{
	        	return true;
	        }
	    });
jQuery.validator.addMethod("f_code_profix",
    function(value, element) {
        if (jQuery(':radio[id=f_sale_type][value=1]').attr('checked')&&jQuery("#f_code_json").val()==""){
	        	if (jQuery('#f_code_profix').val() == ''){
	        		return false;
	        	}else{
	        		return true;
	        	}
        }else{
        	return true;
        }}
    );
jQuery.validator.addMethod("f_code_count",
    function(value, element) {
        if (jQuery(':radio[id=f_sale_type][value=1]').attr('checked')&&jQuery("#f_code_json").val()==""){
	        	if (jQuery('#f_code_count').val() == ''){
	        		return false;
	        	}else{
	        		return true;
	        	}
        }else{
        	return true;
        }}
    );
  jQuery.validator.addMethod("transportId",
    function(value, element) {
        if (jQuery(':radio[id=goods_transfee][value=0]').attr('checked') && jQuery(':radio[id=transport_type][value=0]').attr('checked')){
	        	if (jQuery('#transport_id').val() == ''){
	        		return false;
	        	}else{
	        		return true;
	        	}
        }else{
        	return true;
        }}
    );
//options为编辑配置属性pc
var options1 = {
        cssPath : '$!webPath/resources/editor/plugins/code/prettify.css',
        filterMode : true,
		uploadJson:'$!webPath/upload.htm',
		width : '860px',
		height:'400px',
		resizeType : 1,
		allowImageUpload : true,
		allowFlashUpload : false,
		allowMediaUpload : false,
		allowFileManager : false,
		syncType:"form",
		afterCreate : function() {
							var self = this;
							self.sync();
						},
		afterChange : function() {
							var self = this;
							self.sync();
						},
		afterBlur : function() {
							var self = this;
							self.sync();
						},
		items:['source', '|', 'fullscreen', 'undo', 'redo', 'cut', 'copy', 'paste',
			'plainpaste', 'wordpaste', '|', 'justifyleft', 'justifycenter', 'justifyright',
			'justifyfull', 'insertorderedlist', 'insertunorderedlist', 'indent', 'outdent', 'subscript',
			'superscript', '|', 'selectall', 'clearhtml','quickformat','|',
			'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
			'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image','flash', 'media', 'table', 'hr', 'emoticons', 'link', 'unlink', '|', 'about']
}; 
//options为编辑配置属性app
var options2 = {
        cssPath : '$!webPath/resources/editor/plugins/code/prettify.css',
        filterMode : true,
		uploadJson:'$!webPath/upload.htm',
		width : '360px',
		height:'400px',
		minWidth:'360px',
		resizeType : 1,
		allowImageUpload : false,
		allowFlashUpload : false,
		allowMediaUpload : false,
		allowFileManager : false,
		syncType:"form",
		afterCreate : function() {
							var self = this;
							self.sync();
						},
		afterChange : function() {
							var self = this;
							self.sync();
						},
		afterBlur : function() {
							var self = this;
							self.sync();
						},
		items:['source', '|', 'undo', 'redo', '|', 'justifyleft', 'justifycenter',  'insertorderedlist', 'insertunorderedlist', '|',
			'formatblock', 'fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold',
			'italic', 'underline', 'strikethrough', 'lineheight', 'removeformat', '|', 'image', 'hr', '|', 'about']
}; 
var user_goods_class_count=2;
var type;
jQuery(document).ready(function() {
	<!--初始化时自定义的规格名称替换-->
	#if($!{obj.goods_specs_info})
	 var goods_specs_info=eval($!{obj.goods_specs_info});
	jQuery.each(goods_specs_info,function(index,item){
		jQuery("input[id=spec_"+item.id+"]").attr("gsp_val",item.name);
		jQuery("label[use=spec_"+item.id+"]").find(".cc_sp3").text(item.name);
		jQuery("input[id=specname_"+item.id+"]").val(item.name);
    });
	#end	
	<!--新添加规格属性-->
	init_gs_add();
	
	
	jQuery("a[id=gsp_add]").click(function(){
			
		var button_text=jQuery(this).text();
		if(button_text=="新增规格值"){
			jQuery(this).text("提交");
			jQuery(this).parent().parent().find(".coler_chose_add_left").show();
			}
		if(button_text=="提交"){
			var nameline=jQuery(this).parent().parent().find("input[use=add]");
			var name=nameline.val();
			if(name!=""){
				nameline.val("");
				jQuery(this).parent().parent().find(".coler_chose_add_left").hide();				
				var gs_line=jQuery(this);
				gs_line.text("新增规格");
				jQuery.post("$!webPath/admin/goods_specification_ajax_add.htm",{"gc_id":"$!goods_class.id","name":name},function(text){			
					if(text!=null){
						var data=eval("("+text+")");
						jQuery("tr[use=gsp_add]").before("<tr id=\"gs_"+data.id+"\" gs_name=\""+data.name+"\"><td align=\"right\" valign=\"top\">"+data.name+"：</td><td class=\"sptable\"><ul class=\"color_chose\"><li class=\"coler_chose_add_left\" style=\"display:none;\"><input use=\"add\" type=\"text\" /></li><li class=\"color_chose_add\"><a href=\"javascript:void(0)\" id=\"gs_add_"+data.id+"\" gs_id=\""+data.id+"\">新增规格值</a></li></ul></td></tr>");
						}
					},"text");
				}
			}
					
		});
		
	jQuery(".upload_pictures_bottom ul").sortable({stop: function(event,ui){},start:function(event,ui){},revert: true});
	jQuery(".upload_pictures_bottom ul").bind('sortstop',
		function(event, ui){
			draw_goods_main_img();
			jQuery(ui.item).css("cursor","auto");
		});
	jQuery(".upload_pictures_bottom ul").bind('sortstart',
		function(event, ui){
			jQuery(ui.item).css("cursor","move");
		}); 	
	jQuery(".upload_pictures_bottom ul" ).disableSelection(); 	
  jQuery(":radio[id=goods_status]").click(function(){
    if(jQuery(this).val()==2){
	   jQuery("#publish_info").show();
	 }else{
       jQuery("#publish_info").hide();
	 }
  });
  
    //
  jQuery('#publish_day').attr("readonly","readonly").datepicker({
	  dateFormat:"yy-mm-dd",
	  minDate:0,
	  changeMonth: true,
	  changeYear: true
  });
  //
  jQuery('#advance_date').attr("readonly","readonly").datepicker({
	  dateFormat:"yy-mm-dd",
	  minDate:0,
	  changeMonth: true,
	  changeYear: true
  });
 //默认赋值
  jQuery(":radio[name='goods_other_type']").click(function(){
	  var needGoodsCode = jQuery(this).attr("needGoodsCode");
	  if(needGoodsCode==1){
		   //海信商品需要效验商品编码
		  type=true;
		  jQuery("#tr_needGoodsCode").css("display","");
		  if(jQuery("#id").val()==""){
			  jQuery("#goods_inventory").val(0);
			  document.getElementById('goods_inventory').disabled=true;
		  }else{
			  document.getElementById('goods_inventory').disabled=true;
		  }
		  
	  }else{
		  　//非海信商品无需效验商品编码;
		  type=false;
		  jQuery("#tr_needGoodsCode").css("display","none");
		  document.getElementById('goods_inventory').disabled=false;
	  }
  });
  var goodsConfigCode="$!obj.goodsConfig.configCode";
  if(goodsConfigCode==""){
	  jQuery(":radio[name='goods_other_type']").eq(0).trigger("click");
  }else{
	  jQuery(":radio[name='goods_other_type'][value='"+goodsConfigCode+"']").trigger("click");
  }
 
  jQuery(":radio[id='goods_transfee'][value='$!{obj.goods_transfee}']").attr("checked",true);
  jQuery(":radio[id='goods_status'][value='$!{obj.goods_status}']").attr("checked",true);
  jQuery(":radio[id='inventory_type'][value='$!{obj.inventory_type}']").attr("checked",true);
  jQuery(":radio[id='goods_choice_type'][value='$!{obj.goods_choice_type}']").attr("checked",true);
  jQuery(":radio[id='goods_cod'][value='$!{obj.goods_cod}']").attr("checked",true);
  jQuery("#goods_brand_id").val("$!obj.goods_brand.id");
  jQuery(":radio[id='f_sale_type'][value='$!{obj.f_sale_type}']").attr("checked",true);
  jQuery(":radio[id='advance_sale_type'][value='$!{obj.advance_sale_type}']").attr("checked",true);
  jQuery("#goods_top_format_id").val("$!obj.goods_top_format_id");
  jQuery("#goods_bottom_format_id").val("$!obj.goods_bottom_format_id");
  #foreach($spec in $obj.goods_specs)
    jQuery(":checkbox[id=spec_$!{spec.id}]").attr("checked",true);
  #end
  #if($!obj.inventory_type=="spec")
  var goods_spec_ids="";
   jQuery(":checkbox[id^=spec_][checked=true]").each(function(){
        goods_spec_ids=jQuery(this).val()+","+goods_spec_ids;
   });
   	 inventory_type();
	var inventory_detail='$!obj.goods_inventory_detail';
	 var goods_inventory_detail=eval("("+inventory_detail+")");
	 jQuery.each(goods_inventory_detail, function(index,item){
		jQuery("#inventory_details_count_"+item.id).val(item.count);
		jQuery("#inventory_details_price_"+item.id).val(item.price);	  
	 });
  #end
  #if($!obj.goods_property)
  var data='$!obj.goods_property';
  var properties=eval("("+data+")");
  jQuery.each(properties,function(index,item){
      jQuery("#property_"+item.id).html(item.val);
  });
  #end
  #if($!obj.goods_brand)
   jQuery("#goods_brand").html("$!{obj.goods_brand.name}");
  #end
  //表单验证
 
  jQuery("#theForm").validate({		
	ignore: "",						  
     rules: {
	        goods_class_id:{
			     required:true
			},
			 goods_serial:{
			     maxlength:20
			},
			goods_name:{
			     required:true,
				 minlength:3,
				 maxlength:50
			    },
			 goods_price:{
				number:true,
				range:[0.01,1000000] 
			 },
			 goods_weight:{
				number:true
				},
			goods_volume:{
				number:true
				},	
			 store_price:{
			    required:true,
				number:true,
				range:[0.01,1000000] 
			 },
			 goods_inventory:{
			    number:true,
				range:[0,1000000000] 
			 },
			 transport_id:{transportId:true},
			 f_code_profix:{f_code_profix:true,rangelength:[1,4],profix:true},
			 f_code_count:{f_code_count:true,min:1,max:100000},
			 goods_needGoodsCode:{
			     required:type,
			     number:false,
			     minlength:9,
			     maxlength:9
			    },
			    advance_date:{advance_sale_type:true}
			},
     messages: {
	        goods_class_id:{required:"商品分类不能为空"},
			goods_serial:{maxlength:"输入字符长度不得超过20"},
			goods_name:{
			    required: "商品名不能为空",
			    minlength:"商品名最少为3个字符",
			    maxlength:"商品名最多为50个字符"			   
			  },
			goods_price:{
				number:"商品原价只能是数字格式",
				range:"商品价格只能在0.01-1000000之间"
				},
			goods_weight:{
				number:"只能输入小数及整数"
				},
			goods_volume:{
				number:"只能输入小数及整数"
				},	
			store_price:{
			    required:"店铺价格不能为空",
				number:"店铺价格只能是数字格式",
				range:"店铺价格只能在0.01-1000000之间"
				},
			goods_inventory:{
			    number:"商品库存只能为数字",
				range:"商品库存数量只能在1-1000000000之间"
			},
			transport_id:{transportId:"请选择一个运费模板"},
			f_code_profix:{f_code_profix:"请输入F码前缀",rangelength:"F码前缀长度为{0}位-{1}位"},
			f_code_count:{f_code_count:"F码数量不能为空",min:"F码数量最小为1",max:"F码数量最大为100000"},
			 goods_needGoodsCode:{
				    required: "商品编码不能为空",
				    number:"商品编码只能是数字格式",
				    minlength: "商品编码长度为9",
				    maxlength:"商品编码长度为9"
				  },
				  advance_date:{advance_sale_type:"发货时间不能为空"}
		  }
  }); 
  jQuery(":input[id^=inventory_details_count_]").live("keyup",function(){
     var goods_inventory=0;
	 jQuery(":input[id^=inventory_details_count_]").each(function(){
		var reg = new RegExp("^[0-9]*$");
		if(!reg.test(jQuery(this).val())){
		    jQuery(this).val("0");
		}
		goods_inventory=parseInt(jQuery(this).val())+goods_inventory;
	 });
	 jQuery("#goods_inventory").val(goods_inventory);
  });
   //
  jQuery(":input[id^=inventory_details_price_]").live("keyup",function(){
	 jQuery(":input[id^=inventory_details_price_]").each(function(){
	 jQuery(this).val(jQuery(this).val().replace(/[^0-9.]/g,''));    
	 });
  });
  
     //物流运费
  jQuery("#buyer_transport_info").find("input[type='text']").live("keyup",function(){
	 jQuery(":input[id='mail_trans_fee']").each(function(){
		 jQuery(this).val(jQuery(this).val().replace(/[^0-9.]/g,''));    
	 });
  });

     //品牌搜索
  jQuery("#brand ul li").click(function(){
     jQuery("#brand").hide();
	 jQuery("#goods_brand").html(jQuery(this).html());
	 jQuery("#goods_brand_id").val(jQuery(this).attr("bid"));
  });
  jQuery("#div_goods_brand").click(function(){
     var count = 0;
	 #if($!gbs.size())
		 count=$!gbs.size();
     #end
	 if(count>0){
       if(jQuery("#brand").is(":hidden")){
		 jQuery("#brand").show();
	   }else{
         jQuery("#brand").hide();
	   }
	   jQuery("#brand ul li").show();
	 }else{	 
	   if(jQuery("#brand_none").is(":hidden")){
		   jQuery("#brand_none").show();
	   }else{
         jQuery("#brand_none").hide();
	   }
	 }
  });
  jQuery.expr[':'].contains = function(a, i, m){
      return jQuery(a).text().toUpperCase()
     .indexOf(m[3].toUpperCase()) >= 0;
   };
   jQuery("#ibrand").keyup(function(){
          jQuery("#brand ul li").hide().filter(":contains('"+( jQuery(this).val() )+"')").show();
   })
  //类型可以搜索
  jQuery("input[id^=keyup_]").keyup(function(){
		  var id=jQuery(this).attr("pid");
          jQuery("#list_"+id+" ul li").hide().filter(":contains('"+( jQuery(this).val() )+"')").show();
   })

 jQuery(".goods_brand_input_top").click(function(){
	 var id=jQuery(this).attr("pid");
		if(jQuery("#list_"+id).is(":hidden")){
		   jQuery("#list_"+id).show();
		}else{
			jQuery("#list_"+id).hide();
			}
	   jQuery("#list_"+id+" ul li").show();
	
  });
 jQuery(".goods_brand_input").each(function(){
	  var s=jQuery(this);
	  jQuery("body").click(function(i){ 
	  if(!jQuery(i.target).parents(".goods_brand_input").first().is(s)){
		  s.find(".goods_brand_input_list").hide();
		  
		  }
	  });
	 });
jQuery(".goods_brand_input_list ul li").click(function(){
      jQuery(this).parent().parent().hide();
	  var id=jQuery(this).parent().parent().attr("lid");
	  jQuery("#property_"+id).html(jQuery(this).html());
  });
  //table切换
  jQuery("#ul_table li").click(function(){
	jQuery(this).parent().find("li a").removeClass("this");	
	jQuery(this).find("a").addClass("this");
	var id =jQuery(this).attr("id");
	jQuery("table").hide();
	jQuery("table[id=goods_"+id+"]").show();
   });
  //
  jQuery(":radio[id=inventory_type]").live("click",inventory_type);
  jQuery(":checkbox[id^=spec_]").live("click",inventory_type);
  //
  editor = KindEditor.create('#goods_details_web',options1);   
  editor2 = KindEditor.create('#goods_details_app',options2);
  //
  jQuery(":radio[id='goods_transfee']").click(function(){
     var val=jQuery(this).val();
	 if(val==0){
	    jQuery("#buyer_transport_info").show();
	  }else{
	    jQuery("#buyer_transport_info").hide();
	  }
  });
  //
  jQuery(":radio[id=f_sale_type]").click(function(){
     if(jQuery(this).val()==1){
	   jQuery("tr[id^=f_code_]").show();
	 }else{
	   jQuery("tr[id^=f_code_]").hide();
	 }
  });
  //
  jQuery(":radio[id=advance_sale_type]").click(function(){
     if(jQuery(this).val()==1){
	   jQuery("tr[id^=advance_sale_]").show();
	 }else{
	   jQuery("tr[id^=advance_sale_]").hide();
	 }
  });
  //
  <!--规格点击时表格中同步更改-->
  jQuery(".cc_sp3").live("click",function(){
  	jQuery(this).next().attr("style","");
  });
  jQuery(":checkbox[id^=spec]").live("click",function(){
  	var a=jQuery(this).parent().next().find(".cc_sp3").next();
	a.attr("style","border: 1px dotted #F00;");
	a.find("input").focus();
	a.find("input").blur(function(){
		a.attr("style","");
	});
  });
  jQuery(":input[id^=specname_]").bind('input propertychange', function() {
	  var specname=jQuery(this).attr("id");
	  var value=jQuery(this).val();
	  jQuery("td[specname="+specname+"]").text(value);
	  specname=specname.replace("specname_","");
	  jQuery("#spec_"+specname).attr("gsp_val",value);
	  }); 
	  <!--初始化时规格选中状态-->
	jQuery("tr[id^=gs_]").each(function(index, element) {
    jQuery(element).find(":checkbox[id^=spec_][checked=true]").each(function(index2, element2){
		var s=jQuery(element).attr("id");
		s=s.replace("gs_","");
		jQuery("a[use='"+s+"']").attr("class","this");
		jQuery("a[use='"+s+"']").attr("visibility","show");		
		jQuery(element).show();
	});
	});
});

function init_gs_add() {
    jQuery("a[id^=gs_add_]").live("click",function() {
        var button_text = jQuery(this).text();
        if (button_text == "新增规格值") {
            jQuery(this).text("提交");
            jQuery(this).parent().parent().find(".coler_chose_add_left").show();
        }
        if (button_text == "提交") {
            var gs_id = jQuery(this).attr("gs_id");
            var nameline = jQuery(this).parent().parent().find("input[use=add]");
            var name = nameline.val();
            if (name != "") {
				if (jQuery(this).parent().parent().parent().parent().attr("gs_type") == "text") {
                nameline.val("");
                jQuery(this).parent().parent().find(".coler_chose_add_left").hide();
                var gs_line = jQuery(this);
                gs_line.text("新增规格值");				
                    jQuery.post("$!webPath/admin/goods_spec_ajax_add.htm", {
                        "id": gs_id,
                        "name": name
                    },
                    function(text) {
                        if (text != null) {
                            var data = eval("(" + text + ")");
                            nameline.parent().before("<li> <span class=\"cc_sp1\"> <input name=\"spec_" + data.id + "\" type=\"checkbox\" id=\"spec_" + data.id + "\" gs_id=\"" + gs_id + "\"  gsp_val=\"" + name + "\" value=\"" + data.id + "\" /> </span> <label use=\"spec_" + data.id + "\"> <span class=\"cc_sp3\">" + name + "</span> <span style=\"visibility: hidden\" class=\"edit\"> <input id=\"specname_" + data.id + "\" name=\"specname_" + data.id + "\" type=\"text\" value=\"" + name + "\"/> </span> </label> </li>");
                            jQuery(":input[id^=specname_]").bind('input propertychange',
                            function() {
                                var specname = jQuery(this).attr("id");
                                var value = jQuery(this).val();
                                jQuery("td[specname=" + specname + "]").text(value);
                                specname = specname.replace("specname_", "");
                                jQuery("#spec_" + specname).attr("gsp_val", value);
                            });
                        }
                    },
                    "text");
                } else {

                    var fileid = "gsp_add_img_" + gs_id;
				var img_src=jQuery("#"+fileid).val();
					if(img_src!=""){				
                nameline.val("");
                jQuery(this).parent().parent().find(".coler_chose_add_left").hide();
                var gs_line = jQuery(this);
                gs_line.text("新增规格值");
				
				jQuery(this).parent().parent().find(".img_see").attr("style","display:none");
  				jQuery(this).parent().parent().find(".img_see").find("img").attr("src","");
                   
                    jQuery.ajaxFileUpload({
                        url: '/admin/goods_spec_ajax_add.htm',
                        fileElementId: [fileid],
                        fileFilter: "$!imageSuffix1",
						data:{
                        "id": gs_id,
                        "name": name
                    	},
                        dataType: 'json',
                        success: function(text) {
                            if (text != null) {
								jQuery("#"+fileid).val("");
                                var data = eval(text);
                                nameline.parent().before("<li> <span class=\"cc_sp1\"> <input name=\"spec_" + data.id + "\" type=\"checkbox\" id=\"spec_" + data.id + "\" gs_id=\"" + gs_id + "\"  gsp_val=\"" + name + "\" value=\"" + data.id + "\" /> </span><span class=\"cc_sp2\"> <img src=\"" + data.url + "\" width=\"16\" height=\"16\" /> </span> <label use=\"spec_" + data.id + "\"> <span class=\"cc_sp3\">" + name + "</span> <span style=\"visibility: hidden\" class=\"edit\"> <input id=\"specname_" + data.id + "\" name=\"specname_" + data.id + "\" type=\"text\" value=\"" + name + "\"/> </span> </label> </li>");
                                jQuery(":input[id^=specname_]").bind('input propertychange',
                                function() {
                                    var specname = jQuery(this).attr("id");
                                    var value = jQuery(this).val();
                                    jQuery("td[specname=" + specname + "]").text(value);
                                    specname = specname.replace("specname_", "");
                                    jQuery("#spec_" + specname).attr("gsp_val", value);
                                });
                            }
                        }

                    });}else{
					showDialog("msg_info","","请选择规格图片",2,"warning",3,'');
				}

                }

            } else{
					showDialog("msg_info","","规格名称不能为空",2,"warning",3,'');
				}

        }
    });
}

function inventory_type(){	
	
  var rv=jQuery(":radio[id=inventory_type][checked=true]").val();
  if(rv=="all"){ 
    jQuery("#inventory_detail").hide();
  }else{
	  <!--保存之前的表格中的数据，重新生成表格后id不变的可以重新赋值回去-->
	  var temp_id = new Array();
	  var temp_count = new Array();
	  var temp_price = new Array();
	  jQuery("input[id^=inventory_details_count_]").each(function(index,element){
		 var id=jQuery(this).attr("name");
		 var count=jQuery(this).val();
		 var price=jQuery("#inventory_details_price_"+id).val();
		 temp_id[index]=id;
		 temp_count[index]=count;
		 temp_price[index]=price;
	  });
	  
	  <!--遍历规格，筛选被选中的规格生成表格-->
	  var gs_name = new Array();
	  var goods_spec_ids = new Array();
	  var goods_spec_name = new Array();
	  
	  var mindex=0;
  jQuery("tr[id^=gs_]").each(function(index, element) {	   
	   var id_temp = new Array();
	   var name_temp = new Array();
    jQuery(element).find(":checkbox[id^=spec_][checked=true]").each(function(index2, element2){
		id_temp[index2]=jQuery(this).val();
		name_temp[index2]=jQuery(this).attr("gsp_val");
  		});
		if(id_temp.length>0){
		gs_name[mindex] = jQuery(element).attr("gs_name");
		goods_spec_ids[mindex]=id_temp;
		goods_spec_name[mindex]=name_temp;
		mindex=mindex+1;
		}
	});	
			
	var table="<table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" class=\"tabledetail\" > <tr style=\"background:#CCC\">";
  	
	
	
	jQuery("#inventory_detail").show();	
	jQuery("#inventory_detail_content").empty();
	if(gs_name.length>0){
		
		for(var i=0;i<gs_name.length;i++){
			table=table+"<td width=\"15%\">"+gs_name[i]+"</td>"
		}
	
	table=table+"<td width=\"27%\"><b style=\"float:left;\">库存</b> <span class=\"select_all\" id=\"select_all_count\" mark=\"count\"><img src=\"$!webPath/resources/style/system/front/default/images/batch.png\" style=\"cursor:pointer\"/></span> <span class=\"select_all_input\" mark=\"count\" style=\"display:none;\"><b>      <input name=\"\" type=\"text\" mark=\"all_count\" />      </b><i><a href=\"javascript:void(0);\" mark=\"count\" id=\"sure_count\">确定</a></i></span></td>    <td width=\"46%\" ><b style=\"float:left;\">价格</b> <span class=\"select_all\" id=\"select_all_price\" mark=\"price\"><img src=\"$!webPath/resources/style/system/front/default/images/batch.png\" style=\"cursor:pointer\"/></span> <span class=\"select_all_input\" mark=\"price\" style=\"display:none;\"><b>      <input name=\"\" type=\"text\" mark=\"all_price\" />      </b><i><a href=\"javascript:void(0);\" mark=\"price\" id=\"sure_price\">确定</a></i></span></td>  </tr>";
	spec_list="";
	format_spec(goods_spec_ids,goods_spec_name,0,"","");
	
	table=table+spec_list;
  	table=table+"</table>";
  	jQuery("#inventory_detail_content").append(table);
  
   if(jQuery("#inventory_detail_content>table").height()>=350){
	  jQuery("#inventory_detail_content").css({"width":"100%","height":"350px","float":"left","overflow":"auto;"});
	}else{
	  jQuery("#inventory_detail_content").css({"width":"100%","height":"auto","float":"left","overflow":"auto"});
	}
	
	<!--之前保存的数据，重新生成表格后id不变的赋值回去-->
	 	  
	  for(var i=0;i<temp_id.length;i++){
	  	var id=temp_id[i];
		jQuery("#inventory_details_count_"+id).val(temp_count[i]);
		jQuery("#inventory_details_price_"+id).val(temp_price[i]);
	  }
	  
	
	jQuery("span[id^=select_all_]").click(function(){
		var mark =	jQuery(this).attr("mark");
		jQuery("span.select_all_input[mark='"+mark+"']").show();
		jQuery(this).hide();
	});	
	
	jQuery("a[id=sure_count]").click(function(){
		var val = jQuery("input[mark=all_count]").val();
		jQuery("#select_all_count").show();
		jQuery("span.select_all_input[mark='count']").hide();
		
		//限整数 
		var reg = new RegExp("^[0-9]+$");
		var reg2 = new RegExp("^[\+]{1}[0-9]+$");
		var reg3 = new RegExp("^[\-]{1}[0-9]+$");	
		
		jQuery("input[id^=inventory_details_count_]").each(function(){
			if(val!=""){				
				if(!reg.test(val)){
					if(reg2.test(val)){
						var num=parseInt(jQuery(this).val())+parseInt(val.replace("+",""));
						if(num>=0)
						jQuery(this).val(num);	
					}else if(reg3.test(val)){
						var num=parseInt(jQuery(this).val())-parseInt(val.replace("-",""));
						if(num>=0)
						jQuery(this).val(num);	
					}
				}else{
					jQuery(this).val(val);	
				}
			}												   							   
		 });		
				
		var goods_inventory=0;
	 	jQuery(":input[id^=inventory_details_count_]").each(function(){
		var reg = new RegExp("^[0-9]*$");
		if(!reg.test(jQuery(this).val())){
		    jQuery(this).val("0");
		}
		goods_inventory=parseInt(jQuery(this).val())+goods_inventory;
	 });
	 jQuery("#goods_inventory").val(goods_inventory);
	});
	
	jQuery("a[id=sure_price]").click(function(){
		var val = jQuery("input[mark=all_price]").val();
		jQuery("#select_all_price").show();
		jQuery("span.select_all_input[mark='price']").hide();
		
		//限整数或小数 
		var reg4 = new RegExp("^[0-9]+(\.[0-9]+)?$");
		var reg5 = new RegExp("^[\+]{1}[0-9]+(\.[0-9]+)?$");
		var reg6 = new RegExp("^[\-]{1}[0-9]+(\.[0-9]+)?$");
		jQuery("input[id^=inventory_details_price_]").each(function(){
			if(val!=""){				
				if(!reg4.test(val)){
					if(reg5.test(val)){
						var num=Math.round(parseFloat(jQuery(this).val())*100 + parseFloat(val.replace("+",""))*100)/100;
						if(num>=0)
						jQuery(this).val(num);	
					}else if(reg6.test(val)){
						var num=Math.round(parseFloat(jQuery(this).val())*100 - parseFloat(val.replace("-",""))*100)/100;
						if(num>=0)
						jQuery(this).val(num);	
					}
				}else{
					jQuery(this).val(val);	
				}
			}												   							   
		 });
	});
	}
																			  
 }
}
/*遍历规格，在表格中添加行*/
var spec_list="";
function format_spec(goods_spec_ids,goods_spec_name,count,name,ids){
	for(var i=0;i<goods_spec_ids[count].length;i++){
		if(count==0){
			name = "";	
			ids = "";		
		}
		
		var str2=name+"<td specname=\"specname_"+goods_spec_ids[count][i]+"\">"+goods_spec_name[count][i]+"</td>";
		var ids2=ids+goods_spec_ids[count][i]+"_";
		
		if(count==goods_spec_ids.length-1){
			spec_list=spec_list+"<tr>"+str2+"<td><input name=\""+ids2+"\" type=\"text\" id=\"inventory_details_count_"+ids2+"\" style=\"border:1px solid #A7A6AA; height:20px; line-height:20px; padding-left:5px;margin-bottom:5px;\" value=\"0\"></td>    <td><input name=\""+ids2+"\" type=\"text\" id=\"inventory_details_price_"+ids2+"\" style=\"border:1px solid #A7A6AA; height:20px; line-height:20px; padding-left:5px;margin-bottom:5px;\" value=\"0\"></td></tr>";
		}else{		
		format_spec(goods_spec_ids,goods_spec_name,count+1,str2,ids2);
		}
	}		
}
//新增规格区域显示与隐藏
function gs_add_show(element){
	var p=jQuery(element).parent().parent();
	if(p.attr("visibility")=="show"){
		p.find("li[use=add]").hide();
		p.attr("visibility","hide");
	}else{
		p.find("li[use=add]").show();
		p.attr("visibility","show");
	}
}
//取消
function cancle_gs_add(element){
	var p=jQuery(element).parent().parent();
	p.attr("visibility","hide");
	p.find("li[use=add]").hide();	
}
//提交
function submit_gs_add(element) {
    var gs_add_name = jQuery("#gs_add_name").val();
    var gs_add_sequence = jQuery("#gs_add_sequence").val();
    var gs_add_type = jQuery(":radio[name=gs_add_type][checked=true]").val();	
	if(gs_add_name=="")
	showDialog("msg_info","","规格名称不能为空",2,"warning",3,function(){});
	else
    jQuery.post("$!webPath/admin/goods_specification_ajax_add.htm", {
        "gc_id": "$!goods_class.id",
        "name": gs_add_name,
        "sequence": gs_add_sequence,
        "type": gs_add_type
    },
    function(text) {
        if (text != null) {
			var p=jQuery(element).parent().parent();
			p.attr("visibility","hide");
			p.find("li[use=add]").hide();	
            var data = eval("(" + text + ")");
			
			jQuery(".standard_list").append("<span><a href=\"javascript:void(0)\" onclick=\"show_line(this)\" class=\"this\" use=\""+data.id+"\" visibility=\"hide\">"+data.name+"</a></span>");			
			
            jQuery("tr[id^=gs_]").each(function(index, element) {				
				if(data.type=="text"){
                if (jQuery(element).attr("gs_sequence") > data.sequence) {
                    jQuery(element).before("<tr id=\"gs_" + data.id + "\" gs_name=\"" + data.name + "\"  gs_type=\"text\"><td align=\"right\" valign=\"top\">" + data.name + "：</td><td class=\"sptable\"><ul class=\"color_chose\"><li class=\"coler_chose_add_left\" style=\"display:none;\"><input use=\"add\" type=\"text\" /></li><li class=\"color_chose_add\"><a href=\"javascript:void(0)\" id=\"gs_add_" + data.id + "\" gs_id=\"" + data.id + "\">新增规格值</a></li></ul></td></tr>");
                    jQuery("#gs_add_name").val("");
                    jQuery("#gs_add_sequence").val("");
                    return false;
                }
                if (index == jQuery("tr[id^=gs_]").length - 1) {
                    jQuery(element).after("<tr id=\"gs_" + data.id + "\" gs_name=\"" + data.name + "\" gs_type=\"text\"><td align=\"right\" valign=\"top\">" + data.name + "：</td><td class=\"sptable\"><ul class=\"color_chose\"><li class=\"coler_chose_add_left\" style=\"display:none;\"><input use=\"add\" type=\"text\" /></li><li class=\"color_chose_add\"><a href=\"javascript:void(0)\" id=\"gs_add_" + data.id + "\" gs_id=\"" + data.id + "\">新增规格值</a></li></ul></td></tr>");
                    jQuery("#gs_add_name").val("");
                    jQuery("#gs_add_sequence").val("");
                    return false;
                }
				}else{
					if (jQuery(element).attr("gs_sequence") > data.sequence) {
                    jQuery(element).before("<tr id=\"gs_" + data.id + "\" gs_name=\"" + data.name + "\" gs_type=\"img\"><td align=\"right\" valign=\"top\">" + data.name + "：</td><td class=\"sptable\"><ul class=\"color_chose\"><li class=\"coler_chose_add_left\" style=\"display:none;\"><span class=\"img_file\">添加图片<input class=\"input_img\" id=\"gsp_add_img_" + data.id + "\" name=\"gsp_add_img_" + data.id + "\" use=\"add_img\" type=\"file\" width=\"16\" height=\"16\"  onchange=\"gs_change_img(this)\"/></span><b class=\"img_see\" style=\"display:none\"><img src=\"\" /></b><input use=\"add\" type=\"text\" /></li><li class=\"color_chose_add\"><a href=\"javascript:void(0)\" id=\"gs_add_" + data.id + "\" gs_id=\"" + data.id + "\">新增规格值</a></li></ul></td></tr>");
                    jQuery("#gs_add_name").val("");
                    jQuery("#gs_add_sequence").val("");
                    return false;
                }
                if (index == jQuery("tr[id^=gs_]").length - 1) {
                    jQuery(element).after("<tr id=\"gs_" + data.id + "\" gs_name=\"" + data.name + "\" gs_type=\"img\"><td align=\"right\" valign=\"top\">" + data.name + "：</td><td class=\"sptable\"><ul class=\"color_chose\"><li class=\"coler_chose_add_left\" style=\"display:none;\"><span class=\"img_file\">添加图片<input class=\"input_img\" id=\"gsp_add_img_" + data.id + "\" name=\"gsp_add_img_" + data.id + "\" use=\"add_img\" type=\"file\" width=\"16\" height=\"16\"  onchange=\"gs_change_img(this)\"/></span><b class=\"img_see\" style=\"display:none\"><img src=\"\" /></b><input use=\"add\" type=\"text\" /></li><li class=\"color_chose_add\"><a href=\"javascript:void(0)\" id=\"gs_add_" + data.id + "\" gs_id=\"" + data.id + "\">新增规格值</a></li></ul></td></tr>");
                    jQuery("#gs_add_name").val("");
                    jQuery("#gs_add_sequence").val("");
                    return false;
                }
				}
            });
			if(jQuery("tr[id^=gs_]").length==0){
					if(data.type=="text"){
                    p.parent().parent().parent().after("<tr id=\"gs_" + data.id + "\" gs_name=\"" + data.name + "\" gs_sequence=\"" + data.sequence + "\" gs_type=\"text\"><td align=\"right\" valign=\"top\">" + data.name + "：</td><td class=\"sptable\"><ul class=\"color_chose\"><li class=\"coler_chose_add_left\" style=\"display:none;\"><input use=\"add\" type=\"text\" /></li><li class=\"color_chose_add\"><a href=\"javascript:void(0)\" id=\"gs_add_" + data.id + "\" gs_id=\"" + data.id + "\">新增规格值</a></li></ul></td></tr>");
                    jQuery("#gs_add_name").val("");
                    jQuery("#gs_add_sequence").val("");
                    return false;
				}else{
                    p.parent().parent().parent().after("<tr id=\"gs_" + data.id + "\" gs_name=\"" + data.name + "\" gs_sequence=\"" + data.sequence + "\" gs_type=\"img\"><td align=\"right\" valign=\"top\">" + data.name + "：</td><td class=\"sptable\"><ul class=\"color_chose\"><li class=\"coler_chose_add_left\" style=\"display:none;\"><span class=\"img_file\">添加图片<input class=\"input_img\" id=\"gsp_add_img_" + data.id + "\" name=\"gsp_add_img_" + data.id + "\" use=\"add_img\" type=\"file\" width=\"16\" height=\"16\"  onchange=\"gs_change_img(this)\"/></span><b class=\"img_see\" style=\"display:none\"><img src=\"\" /></b><input use=\"add\" type=\"text\" /></li><li class=\"color_chose_add\"><a href=\"javascript:void(0)\" id=\"gs_add_" + data.id + "\" gs_id=\"" + data.id + "\">新增规格值</a></li></ul></td></tr>");
                    jQuery("#gs_add_name").val("");
                    jQuery("#gs_add_sequence").val("");
                    return false;
                }
				}
        }
    },
    "text");
}
//显示选中的规格行
function show_line(element){
	var id=jQuery(element).attr("use");
	if(jQuery(element).attr("visibility")=="hide"){
		jQuery(element).attr("class","this");
		jQuery("tr[id=gs_"+id+"]").show();
		jQuery(element).attr("visibility","show")
	}else{
		jQuery(element).attr("class","");
		jQuery("tr[id=gs_"+id+"]").hide();
		jQuery(element).attr("visibility","hide")
	}
}
function gs_change_img(element){
	var src=getFullPath(jQuery(element)[0]);	
	if(navigator.appName=="Microsoft Internet Explorer"){//ie
		element.select();
		src=document.selection.createRange().text;   
		jQuery(element).parent().parent().find(".img_see").attr("style","");
  		jQuery(element).parent().parent().find(".img_see").find("img").attr("src",src); 
	}else{//其他浏览器
		var file = element.files[0];  
            if(window.FileReader) {  
                var fr = new FileReader();  
                fr.onloadend = function(e) {  
                    src = e.target.result;  
					jQuery(element).parent().parent().find(".img_see").attr("style","");
  					jQuery(element).parent().parent().find(".img_see").find("img").attr("src",src);
                };  
                fr.readAsDataURL(file);  
            } 
	}
}
/*Ajax分页*/
function ajaxPage(url,currentPage,obj){
  var ajax_page=jQuery(obj).parent().attr("ajax_page");
  if(ajax_page=="goods_transport"){
     jQuery.post("$!webPath/admin/goods_transport.htm",{"currentPage":currentPage,"ajax":true},function(data){
         jQuery("#ListForm").empty().html(data);
      },"html");
  }else if(ajax_page=="goods_img"){
     var ajax_type=jQuery(obj).parent().attr("ajax_type");
     var type=jQuery(obj).parent().attr("type");
	 var album_id=jQuery(obj).parent().attr("album_id");
     jQuery.post("$!webPath/admin/goods_img.htm",{"currentPage":currentPage,"type":type,"album_id":album_id},function(text){
       jQuery(ajax_type).empty();
	   jQuery(ajax_type).append(text);
     },"text");

  }else if(ajax_page=="goods_album"){
	  var ajax_type=jQuery(obj).parent().attr("ajax_type");
	  var album_name=jQuery("#id_"+ajax_type.substring(1)).val();
     jQuery.post("$!webPath/admin/goods_album.htm",{"currentPage":currentPage,"ajax_type":ajax_type,"album_name":album_name},function(text){
       jQuery(ajax_type).empty();
	   jQuery(ajax_type).append(text);
     },"text");
  }
}
function saveForm(){
	
	if(jQuery("#auto_advance_sale").attr("checked")){
		var days = jQuery("#advance_sale_days").val();
		var inventory = jQuery("#advance_sale_inventory").val();
		if(days == 0 && inventory == 0 && days != null && inventory != null){
			alert("您设置了库存为0时开启预售，必须输入发货时间及预售库存。");
			return false;
		}
	}
	
	if(jQuery("input[name=inventory_type]:checked").val() == "spec") {
		if(jQuery("#inventory_detail_content tr").length < 2) {
			alert("请至少配置一种规格库存");
			return false;
		}
	}
	
	var typeLabelLen=jQuery(".goodsconfigTypeLabel").length;
    if(typeLabelLen<1){
	   alert("请配置商品来源");
	   return false;
    }
    
    var tr_needGoodsCode_display=jQuery("#tr_needGoodsCode").css("display");
    if(tr_needGoodsCode_display != 'none'){
    	if(jQuery("#goods_needGoodsCode").val() != ""){
    		if(validatorGoodsCode()){
    			alert("商品编码存在");
        		return false;
    		}
    	}    	
    }
	
  	editor.sync();//同步编辑器的数据到texterea
  	editor2.sync();
	var image_ids="";
	var main_image_id="";
	jQuery(".upload_pictures_bottom_i img").each(function(index, element) {
		var image_id=jQuery(element).attr("img_id");
		if(index==0){
			main_image_id=image_id;
		}else{
			image_ids=image_ids+","+image_id;
		}
		
	});	
  if(image_ids=="" && main_image_id==""){
	  alert("请至少上传一张商品图片！");
 	}else{
  	jQuery("#image_ids").val(image_ids);
	jQuery("#goods_main_img_id").val(main_image_id);
  var goods_spec_ids="";
  var goods_spec_id_value_map="";
  jQuery(":checkbox[id^=spec_][checked=true]").each(function(){
     goods_spec_ids=jQuery(this).val()+","+goods_spec_ids;
	  goods_spec_id_value_map=jQuery(this).val()+":"+jQuery("#specname_"+jQuery(this).val()).val()+","+goods_spec_id_value_map;
  });
  jQuery("#goods_spec_ids").val(goods_spec_ids);
  jQuery("#goods_spec_id_value").val(goods_spec_id_value_map);
  var goods_properties="";
  jQuery("label[id^=property_]").each(function(){
		if(jQuery(this).html()!=""){
		   goods_properties=jQuery(this).attr("id").substring(9)+","+jQuery(this).html()+";"+goods_properties;
		}
  });
  jQuery("#goods_properties").val(goods_properties);
  var intentory_details="";
  jQuery("input[id^=inventory_details_count_]").each(function(){
	 var id=jQuery(this).attr("name");
	 var count=jQuery(this).val();
	 var price=jQuery("#inventory_details_price_"+id).val();
	 intentory_details=id+","+count+","+price+";"+intentory_details;
  });
  jQuery("#intentory_details").val(intentory_details);
  jQuery("#theForm").submit();
    }
}
function switch_detail_editor(str){
	jQuery("a[id^='detail_']").removeClass("this");
	jQuery("#detail_"+str).addClass("this");
	
	jQuery("#goods_details_div_web").hide();
	jQuery("#goods_details_div_app").hide();
	jQuery("#goods_details_div_"+str).show();
	if(str=="app")
		jQuery("#goods_details_div_app_content").show();
	else
		jQuery("#goods_details_div_app_content").hide();
}
//商品图片删除
function del_goods_image(img_id,obj){
  if(confirm("删除后不可恢复，是否继续？")){	
	jQuery(obj).parent().parent().remove();
	jQuery.post("$!webPath/admin/goods_image_del.htm",{"image_id":img_id},function(data){
	    if(data.result==true){
			draw_goods_main_img();
			jQuery(".add_img").show();
		}else showDialog("msg_info","","删除失败!",2,"warning",3,'');
	},"json");
  }				   
}
function remove_goods_image(obj){
	jQuery(obj).parent().parent().remove();
	draw_goods_main_img();
	jQuery(".add_img").show();
}
//根据传入新图片的URL，绘制下方小图。
function  draw_goods_img(img_url,img_id){
	if(jQuery("#show_img").children().size()==5) {alert("最多可选择5张商品图片"); return;}
	jQuery("#show_img").append("<li><span class='upload_pictures_bottom_i'><img src='"+img_url+"' img_id='"+img_id+"' title='可拖动' /></span><span class='upload_pictures_bottom_del'><a href='javascript:void(0)' onclick='del_goods_image("+img_id+",this)'><img src='$!imageWebServer/resources/style/system/front/default/images/usercenter/del_left.png' title='删除图片文件' /></a><a href='javascript:void(0)' onclick='remove_goods_image(this)'><img src='$!imageWebServer/resources/style/system/front/default/images/usercenter/del_right.png' title='删除图片数据'/></a></span></li>");
	draw_goods_main_img();
	if(jQuery("#show_img").children().size()>=5) jQuery(".add_img").hide();	
}
/*绘制商品主图*/
function  draw_goods_main_img(){
	if(jQuery("#show_img").children().size()==0){
		jQuery(".upload_pictures_top_img img").attr("src",null);
	}else if(jQuery("#show_img").children().size()>=1){
		var img_url=jQuery(".upload_pictures_bottom_i img").attr("src");
		jQuery(".upload_pictures_top_img img").attr("src",img_url);
	}
}
//商品图片ajax上传
var upload_goods_img_mark = false;
function upload_goods_img(){
	upload_goods_img_mark = true;
	jQuery.ajaxFileUpload({url:'$!webPath/admin/swf_upload.htm',
								  dataType:'json',
								  fileElementId:['imgFile'],
								  fileFilter:"$!imageSuffix1",
								  success:function(data){
									  jQuery(".add_loading").removeClass("add_loading").addClass("add_img");
				 					draw_goods_img(data.url,data.id);
								  }
		});
	upload_goods_img_mark = false;	
}
jQuery(document).ajaxStart(function() {
	if(upload_goods_img_mark){
		jQuery(".add_img").removeClass("add_img").addClass("add_loading");
	}
});

/***
 * 查询商品编码
 */
function validatorGoodsCode(){
	var codeFlag=false;
	jQuery.ajax({
		  type:'POST',
		  url:'$!webPath/validator_goods_code.htm',
		  data:"goodsCode="+jQuery("#goods_needGoodsCode").val()+"&goodsId="+jQuery("#id").val(),
		  cache:false,
		  async:false,
		  success:function(data){
			  if(data=="yes"){//存在
				  codeFlag=true;
			  }
	      },
	      error:function() {  
	    	  alert("查询商品编码错误");
	    	  codeFlag=true;
	      }  
	});
	return codeFlag;
}
</script>
<style type="text/css">
label.error {
	color: #F00;
	margin-left: 3px;
}
input.error {
	border: 2px solid #F00;
}
</style>
</head>
<body>
<div class="cont">
  <h3 class="seth">#if($!edit)商品编辑#else商品发布#end</h3>
  <div class="nav_list">
    <ul id="ul_table">
      <li id="info"><a href="javascript:void(0);" class="this"><b>商品详细</b></a></li>
      <li id="img"><a href="javascript:void(0);"><b>商品图片</b></a></li>
      <li id="description"><a href="javascript:void(0);"><b>详情描述</b></a></li>
      <li id="spec"><a href="javascript:void(0);"><b>特殊商品</b></a></li>
      <li id="format"><a href="javascript:void(0);"><b>商品版式</b></a></li>
      <li id="pack"><a href="javascript:void(0);"><b>包装清单</b></a></li>
      <li id="other"><a href="javascript:void(0);"><b>其他信息</b></a></li>
    </ul>
  </div>
  <div class="adddetail">
    <form action="$!webPath/admin/add_goods_finish.htm" method="post" enctype="multipart/form-data" name="theForm" id="theForm">
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail" id="goods_info" >
        <tr>
          <td colspan="2" class="tableh1">商品详细</td>
        </tr>
        <tr>
          <td width="95" align="right">商品分类：</td>
          <td><span>$!goods_class_info</span><span class="editbtn">
            <input name="edit_class" type="button" id="edit_class" value="编辑" style="cursor:pointer;" onclick="window.location.href='$!webPath/admin/add_goods_first.htm?id=$!obj.id&add_type=edit_class'" />
            <!-- 掩藏列表页带过来的当前页面 -->
            <input name="currentPage" type="hidden" id="currentPage" value="$!currentPage" />
            <!-- 掩藏列表页带过来的tab页类型 -->
            <input name="status" type="hidden" id="status" value="$!status" />
            <input name="goods_class_id" type="hidden" id="goods_class_id" value="$!{goods_class.id}" />
            <input name="goods_spec_ids" type="hidden" id="goods_spec_ids" />
            <input name="goods_properties" type="hidden" id="goods_properties" />
            <input type="hidden" name="intentory_details" id="intentory_details" />
            <input name="goods_type" type="hidden" id="goods_type" value="0" />
            <input name="id" type="hidden" id="id" value="$!obj.id" />            
              <input name="goods_spec_id_value" type="hidden" id="goods_spec_id_value" />
            </span></td>
        </tr>
        
        <tr>
            <td align="right" valign="top">商品来源：</td>
            <td class="sptable">
            #set($goods_config_num="0")
            
            #foreach($gcon in $goodsConfigs)
                #set($goods_config_num="1")
                <label class="goodsconfigTypeLabel">
                    <input type="radio" name="goods_other_type" id="goods_other_type" value="$!gcon.configCode" needGoodsCode="$!gcon.needGoodCode" />
                    $!gcon.synName           
                </label>
            #end
            
            #if($!goods_config_num == "0")
                                        请配置商品来源
            #end
                
           </td>
        </tr>
        <tr id="tr_needGoodsCode" style="display:none;">
            <td align="right" valign="top">商品编码：</td>
             <td class="sptable"><span class="tabtxt1 size1">
	                <input type="text" name="goods_needGoodsCode"  id="goods_needGoodsCode"  value="$!obj.productMapping.goodsCode"  maxlength="9" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^0-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" 
	                onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^0-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"/>
	                </span><span class="hui2">商品编码只能是9位的数字</span>
             </td>
        </tr>
        
        <tr>
          <td align="right" valign="top">商品名称：</td>
          <td class="sptable"><span class="tabtxt1 size1">
            <input name="goods_name" type="text" id="goods_name" value="$!obj.goods_name" />
            </span> <span class="hui2">商品标题名称长度至少3个字符，最长50个汉字</span></td>
        </tr>
        <tr>
          <td align="right" valign="top">商品原价：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goods_price" type="text" id="goods_price" value="$!obj.goods_price" />
            </span> <span class="hui2">商品原价必须是0.01~1000000之间的数字</span></td>
        </tr>
        <tr>
          <td align="right" valign="top">商品类型：</td>
          <td class="sptable"><label>
              <input name="goods_choice_type" type="radio" id="goods_choice_type" value="0" checked="checked" />
              实物商品 </label>
            <label>
              <input type="radio" name="goods_choice_type" id="goods_choice_type" value="1" />
              虚拟商品 </label>
            <span class="hui2">充值卡、消费券等属于虚拟商品</span></td>
        </tr>
        <tr>
          <td align="right" valign="top">货到付款：</td>
          <td class="sptable"><label>
              <input name="goods_cod" type="radio" id="goods_cod" value="0" disabled="disabled" />
              支持 </label>
            <label>
              <input type="radio" name="goods_cod" id="goods_cod" value="-1" checked="checked" />
              不支持 </label>
            <span class="hui2">该商品是否支持货到付款</span></td>
        </tr>
        <tr>
          <td align="right" valign="top">店铺价格：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="store_price" type="text" id="store_price" value="$!obj.store_price" />
            </span> <span class="hui2">
            <ul class="tableli">
              <li>商品原价必须是0.01~1000000之间的数字</li>
              <li>若启用了库存配置，请在下方商品库存区域进行管理</li>
              <li>商品规格库存表中如有价格差异，店铺价格显示为价格区间形式</li>
            </ul>
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">选择规格：</td>
          <td class="sptable"><div class="standard">
              <ul visibility="hide">
                <li class="standard_list">#foreach($gs in $goods_spec_list)<span><a href="javascript:void(0)" onclick="show_line(this)" use="$!gs.id" visibility="hide">$!gs.name</a></span>#end</li>
                <li class="standard_add"><i>点击规格值名称可以进行修改，仅限此商品适用。使用建议：将金色修改为土豪金时使用此功能，需要蓝色规格的时候新建一个规格值而不是修改。没有想要的规格？</i><a href="javascript:void(0)" onclick="gs_add_show(this);" >立即添加</a></li>
                <li class="standard_add_list" style="display:none" use="add"> <span class="standard_add_list_name"><b>规格名称：</b>
                  <input id="gs_add_name" name="gs_add_name" type="text" />
                  </span> <span id="nothis"> <strong class="q"></strong> <strong class="w">请填写常用的商品规格的名称；例如：颜色；尺寸等。</strong> <strong class="c"></strong> </span> </li>
                <li class="standard_add_list" style="display:none" use="add"> <span class="standard_add_list_name"><b>规格排序：</b>
                  <input id="gs_add_sequence" name="gs_add_sequence" type="text" />
                  </span> <span id="nothis"> <strong class="q"></strong> <strong class="w">请填写整数。类型列表将会根据排序进行由小到大排列显示。</strong> <strong class="c"></strong> </span> </li>
                <li class="standard_add_list" style="display:none" use="add"> <span class="standard_add_list_word"><b>规格类型：</b> <label><i><em>
                  <input id="gs_add_type" name="gs_add_type" type="radio" value="text" checked="checked" />
                  </em>文字</i> </label><label><i><em>
                  <input id="gs_add_type" name="gs_add_type" type="radio" value="img" />
                  </em>图片</i></label></span> <span id="nothis"> <strong class="q"></strong> <strong class="w">图片类型的规格值用于直观表现某些特殊规格类型，例如颜色规格，可用对应的色彩图片来表现其各种颜色值。</strong> <strong class="c"></strong> </span> </li>
                <li class="standard_add_botton" style="display:none" use="add"><a href="javascript:void(0)" class="cancel" onclick="cancle_gs_add(this)">取消</a><a href="javascript:void(0)" onclick="submit_gs_add(this)">提交</a></li>
              </ul>
            </div></td>
        </tr>
        #foreach($gs in $goods_spec_list)
        <tr id="gs_$!{gs.id}" gs_name="$!{gs.name}" style="display:none" gs_sequence="$!{gs.sequence}" #if($!gs.type=="img") gs_type="img" #else gs_type="text" #end>
          <td align="right" valign="top">$!{gs.name}：</td>
          <td class="sptable"><ul class="color_chose">
              #foreach($gsp in $!gs.properties)
              <li> <span class="cc_sp1">
                <input name="spec_$!{gsp.id}" type="checkbox" id="spec_$!{gsp.id}" gs_id="$!gs.id"  gsp_val="$!gsp.value" value="$!gsp.id" />
                </span>
                <label use="spec_$!{gsp.id}"> #if($!gs.type=="img") <span class="cc_sp2"> <img src="$!{gsp.specImage.path}/$!{gsp.specImage.name}" width="16" height="16" /> </span> #end <span class="cc_sp3">$!gsp.value</span> <span style="visibility: hidden;" class="edit">
                  <input id="specname_$!{gsp.id}" name="specname_$!{gsp.id}" type="text" value="$!gsp.value"/>
                  </span> </label>
              </li>
              #end
              <li class="coler_chose_add_left" style="display:none;">
              	#if($!gs.type=="img") <span class="img_file">添加图片<input class="input_img" id="gsp_add_img_$!{gs.id}" name="gsp_add_img_$!{gs.id}" use="add_img" type="file" width="16" height="16"  onchange="gs_change_img(this)"/></span><b class="img_see" style="display:none"><img src="" /></b>#end
                <input use="add" type="text" />
              </li>
              <li class="color_chose_add"><a href="javascript:void(0)" id="gs_add_$!{gs.id}" gs_id="$!{gs.id}">新增规格值</a></li>
            </ul></td>
        </tr>
        #end          
        <tr >
          <td align="right" valign="top">库存配置：</td>
          <td class="sptable"><label>
              <input name="inventory_type" id="inventory_type" type="radio" value="all" checked="checked" />
              全局配置 </label>
            <label>
              <input type="radio" name="inventory_type" id="inventory_type" value="spec" />
              规格配置 </label>
            <span class="hui2">
            <ul class="tableli">
              <li>全局配置表示所有规格无单独库存、价格配置</li>
              <li>规格配置需要配置对应属性的库存、价格</li>
            </ul>
            </span></td>
        </tr>
        <tr id="inventory_detail" style="display:none;">
          <td align="right" valign="top">详细库存：</td>
          <td class="sptable"><div id="inventory_detail_content" style="width:98%;height:auto;overflow:auto;"></div></td>
        </tr>
        <tr >
          <td align="right" valign="top">商品库存：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goods_inventory" type="text" id="goods_inventory" value="$!obj.goods_inventory"/>
           	 #if($!obj.auto_advance_sale == true)
            	<input type="checkbox" checked="checked" name="auto_advance_sale"  id="auto_advance_sale" value="1" style="width:16px; vertical-align:middle; margin-bottom:2px; *margin-bottom:2px;"/>
            #else
           		<input type="checkbox" name="auto_advance_sale"  id="auto_advance_sale" value="1" style="width:16px; vertical-align:middle; margin-bottom:2px; *margin-bottom:2px;"/>
           	#end
           	商品库存为0时自动转为预售商品，发货时间为：
           	<input style="width:80px" name="advance_sale_days" type="text" id="advance_sale_days" value="$!obj.advance_sale_days" maxlength="9" onkeydown="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" 
	                onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"/>天后，
           	预售库存为：<input style="width:100px" name="advance_sale_inventory" type="text" id="advance_sale_inventory"  value="$!obj.advance_sale_inventory" maxlength="9" onkeydown="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}" 
	                onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"/>
            </span> <span class="hui2">
            <ul class="tableli">
              <li>商铺库存数量必须为1~1000000000之间的整数</li>
              <li>若启用了库存配置，则系统自动计算商品的总数，此处无需商家填写</li>
            </ul>
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">商品货号：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goods_serial" type="text" id="goods_serial" value="$!obj.goods_serial" />
            </span> <span class="hui2">
            <ul class="tableli">
              <li>商品货号是指商家个人管理商品的编号，买家不可见</li>
              <li>最多可输入20个字符，支持输入中文、字母、数字、_、/、-和小数点</li>
            </ul>
            </span></td>
        </tr>
      </table>
      <table id="goods_img" style="display:none" width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail">
        <tr>
          <td class="tableh1" colspan="2">商品图片</td>
        </tr>
        <tr>
          <td align="right" width="95" valign="top">商品图片：</td>
          <script>
		 function photo_switch(clz,obj){
			 if(clz=="tab_body_b"){
			 var album_id = jQuery(obj).attr("album_id");
			 jQuery.post("$!webPath/admin/goods_img.htm",{"type":"goods_img_album","album_id":album_id},function(text){
				jQuery(".tab_body_b").empty();
				jQuery(".tab_body_b").append(text);
			  },"text");
			 }
			 jQuery("."+clz).show();			  
			}
			function show_album(clz,obj){
				 //判断是否是点击"tab_body_b"内部按钮进入的方法，如果是a,就是内部搜索按钮，b就是内部查看所有相册。内部进入的不需要修改class值。
				if(obj!=="a" && obj!=="b"){
				 jQuery(".tabbody_ul li").removeClass("this");
			 	 jQuery(obj).addClass("this");
				 jQuery(".tab_body_b").empty();
				}
				if(clz=="tab_body_b"){
					jQuery("#id_tab_body_b").val("")
					 var name=""
					 if(obj=="a"){
						 name=jQuery("input[m='.tab_body_b']").val();
						 jQuery("#id_tab_body_b").val(name);
					 }
			 		 jQuery.post("$!webPath/admin/goods_album.htm",{"ajax_type":".tab_body_b","album_name":name},function(text){
				 	 jQuery(".tab_body_b").empty();
				 	 jQuery(".tab_body_b").append(text);
			       		 },"text");
				} 
				  jQuery("."+clz).show();		
					}
		  </script>
          <input id="id_tab_body_b" type="hidden" />
          <td><div class="tab_body" style="width: 1040px">
              <ul class="tabbody_ul">
                <li class="this" style="cursor:pointer;" onclick="show_album('tab_body_a',this)">上传图片</li>
                <li style="cursor:pointer;" onclick="show_album('tab_body_b',this)">从用户相册选择</li>
              </ul>
              <div class="tabbodys" style="width: 1038px;">
                <div class="tab_body_b" style="width: 1040px;"></div>
                <div class="tab_body_a" style="width: 1040px;">
                  <div class="upload_pictures">
                    <div class="upload_pictures_top">
                      <div class="upload_pictures_top_img"><img #if($!obj.goods_main_photo)
                    src="$!{obj.goods_main_photo.path}/$!{obj.goods_main_photo.name}" 
                    #end /></div>
                    </div>
                    <div class="upload_pictures_bottom">
                      <ul id="show_img">
                        #if($!obj.goods_main_photo)
                        <li> <span class="upload_pictures_bottom_i"><img src="$!{obj.goods_main_photo.path}/$!{obj.goods_main_photo.name}" img_id="$!{obj.goods_main_photo.id}" title="可拖动" /></span> <span class="upload_pictures_bottom_del"> <a href="javascript:void(0)" onclick="del_goods_image('$!{obj.goods_main_photo.id}',this)"><img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_left.png" title="删除图片文件" /></a> <a href="javascript:void(0)" onclick="remove_goods_image(this)"><img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_right.png"  title="删除图片数据" /></a> </span> </li>
                        #end
                        #foreach($img in $obj.goods_photos)
                        #if($velocityCount==1)
                        #set($img2="$!{img.path}/$!{img.name}")
                        #set($img2_id="$!img.id")
                        <li><span class="upload_pictures_bottom_i"><img src="$!{img2}" img_id="$!{img2_id}" title="可拖动" /></span> <span class="upload_pictures_bottom_del"> <a href="javascript:void(0)" onclick="del_goods_image('$!{img2_id}',this)"><img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_left.png"  title="删除图片文件" /></a> <a href="javascript:void(0)" onclick="remove_goods_image(this)"><img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_right.png"  title="删除图片数据" /></a> </span></li>
                        #end
                        #if($velocityCount==2)
                        #set($img3="$!{img.path}/$!{img.name}")
                        #set($img3_id="$!img.id")
                        <li><span class="upload_pictures_bottom_i"><img src="$!{img3}" img_id="$!{img3_id}" title="可拖动" /></span> <span class="upload_pictures_bottom_del"> <a href="javascript:void(0)" onclick="del_goods_image('$!{img3_id}',this)"><img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_left.png"  title="删除图片文件" /></a> <a href="javascript:void(0)" onclick="remove_goods_image(this)"><img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_right.png"  title="删除图片数据" /></a> </span></li>
                        #end
                        #if($velocityCount==3)
                        #set($img4="$!{img.path}/$!{img.name}")
                        #set($img4_id="$!img.id")
                        <li><span class="upload_pictures_bottom_i"><img src="$!{img4}" img_id="$!{img4_id}" title="可拖动" /></span> <span class="upload_pictures_bottom_del"> <a href="javascript:void(0)" onclick="del_goods_image('$!{img4_id}',this)"><img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_left.png"  title="删除图片文件" /></a> <a href="javascript:void(0)" onclick="remove_goods_image(this)"><img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_right.png" title="删除图片数据" /></a> </span></li>
                        #end
                        #if($velocityCount==4)
                        #set($img5="$!{img.path}/$!{img.name}")
                        #set($img5_id="$!img.id")
                        <li><span class="upload_pictures_bottom_i"><img src="$!{img5}" img_id="$!{img5_id}" title="可拖动" /></span> <span class="upload_pictures_bottom_del"> <a href="javascript:void(0)" onclick="del_goods_image('$!{img5_id}',this)"><img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_left.png"  title="删除图片文件" /></a> <a href="javascript:void(0)" onclick="remove_goods_image(this)"><img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_right.png" title="删除图片数据" /></a> </span></li>
                        #end
                        #end
                      </ul>
                      <ul>
                        <li class="add_img" #if($!obj.goods_photos.size()>=4) style="display:none" #end > <span class="upload_pictures_bottom_w">
                          <input name="imgFile" type="file" id="imgFile" onchange="upload_goods_img()"/>
                          </span> </li>
                      </ul>
                      <input name="image_ids" type="hidden" id="image_ids" />
                      <input name="goods_main_img_id" type="hidden" id="goods_main_img_id" />
                    </div>
                  </div>
                  <!--说明 -->
                  <div class="upload_pictures_statement">
                    <div class="upload_pictures_statement_c"> <img src="$!imageWebServer/resources/style/system/front/default/images/upload_right.png" /> <span>1、最多可发布 <b style="color:#F00">5</b> 张商品图片<br />
                      2、商品主图下方小图可<b style="color:#F00">拖动</b>以便调整顺序<br />
                      3、支持格式：$!{imageSuffix}<br />
                      4、建议选择尺寸<b style="color:#F00">800x800</b>、大小1M内的图片<br />
                      5、空间不限制大小<br />
                      6、<img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_left.png" /> 表示从服务器删除图片文件，不可恢复 <br />
                      7、<img src="$!imageWebServer/resources/style/system/front/default/images/usercenter/del_right.png" /> 表示删除该商品的图片数据
                      </span> </div>
                  </div>
                </div>
              </div>
            </div></td>
        </tr>
      </table>
      <table id="goods_description" style="display:none" width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail">
        <tr>
          <td colspan="2" class="tableh1">详情描述</td>
        </tr>
        #foreach($property in $goods_class.goodsType.properties)
          <tr>
            <td align="right" valign="top">$!{property.name}：</td>
            <td>
            
            <div class="goods_brand_input">
                <div class="goods_brand_input_top" pid="$!{property.id}">
            
                      <label lid="$!{property.id}" class="goods_brand_infor" name="property_$!{property.id}" id="property_$!{property.id}"></label>          
                    
                     <b><a href="javascript:void(0);"></a></b>            
                </div>  
                        
                <div class="goods_brand_input_list" lid="$!{property.id}" id="list_$!{property.id}" style="display:none">
                  <input class="list_search" pid="$!{property.id}" id="keyup_$!{property.id}" type="text" />
                  <ul>
                      #foreach($info in $CommUtil.splitByChar("$!property.value",","))
                      <li>$!info</li>
                      #end
                  </ul>
                 </div>            
            </div>
           </td>
          </tr>
          #end
        <tr>
          <td align="right" valign="top" style="width:95px;">商品描述： </td>
          <td id="detail_td_web"><div style="width:861px; float:left;">
              <div class="detail_td_web_nav">
                <div class="addphoto_c"><a id="detail_web" class="this" href="javascript:void(0);" onclick="switch_detail_editor('web');">电脑端</a></div>
                <div class="addphoto_c"><a id="detail_app" href="javascript:void(0);" onclick="switch_detail_editor('app');">手机端</a></div>
              </div>
              <div id="goods_details_div_web" class="addphoto_c_textarea">
                <textarea name="goods_details" style="width:100%;height:400px;visibility:hidden;" id="goods_details_web">$!obj.goods_details</textarea>
              </div>
              <div id="goods_details_div_app" style="display:none; float:left;">
                <textarea name="goods_details_mobile" style="width:100%;height:400px;visibility:hidden;" id="goods_details_app">$!obj.goods_details_mobile</textarea>
              </div>
              <div id="goods_details_div_app_content" class="goods_details_div_app_right" style="display:none;">
                <li>手机端商品描述说明：</li>
                <li>1.手机端商品描述用于手机app，描述应该符合手机用户的使用场景。</li>
                <li>2.由于手机端的特殊性，建议只使用图片和文字来描述您的商品，并合理安排您的图片的数量和大小。</li>
              </div>
            </div>
            <script>
              function switch_editor_photo(obj){
			  var album_id = jQuery(obj).attr("album_id");
				jQuery.post("$!webPath/admin/goods_img.htm",{"type":"goods_detail_album","album_id":album_id},function(text){
				   jQuery(".editor_photo_detail").empty();																					  
			  	   jQuery(".editor_photo_detail").append(text);
			    },"text"); 
				jQuery(".editor_photo_detail").show();
		   }
		   
		   
		   		function switch_editor_album(mark){
				 jQuery("#id_editor_photo_detail").val("");
				    var dis=jQuery(".editor_photo_detail").css("display");
						  if(dis=="none" || mark=="album_list" || mark=="all"){
							  var name=jQuery("input[m='.editor_photo_detail']").val();
							  if(mark=="all"){name="";} 
							  if(name!=""){
	                            jQuery("#id_editor_photo_detail").val(name);
							  }
							jQuery.post("$!webPath/admin/goods_album.htm",{"type":"goods_detail_album","ajax_type":".editor_photo_detail","album_name":name},function(text){
							   jQuery(".editor_photo_detail").empty();																					  
							   jQuery(".editor_photo_detail").append(text);
							},"text"); 
							jQuery(".editor_photo_detail").show();
						  }else{
							jQuery(".editor_photo_detail").hide();
						  }		
			 }
           </script>
           <input id="id_editor_photo_detail" type="hidden" />
            <div class="photoimg" style="width:100%; float:left;">
              <div class="addphoto_b"><a href="javascript:void(0);" onclick="switch_editor_album('');">插入相册图片</a></div>
              <div class="editor_photo_detail" style="display:none;"> </div>
            </div></td>
        </tr>
      </table>
      <table id="goods_pack" style="display:none;" width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail">
        <tr>
          <td colspan="2" class="tableh1">包装清单</td>
        </tr>
        <tr>
          <td align="right" valign="top">清单详情：</td>
          <td><textarea name="pack_details" cols="140" rows="10"  style="resize:none" id="pack_details">$!obj.pack_details</textarea></td>
        </tr>
        <tr>
          <td align="right" valign="top">售后保障：</td>
          <td><textarea name="goods_service"   cols="140" rows="10"  style="resize:none" id="goods_service">$!obj.goods_service</textarea></td>
        </tr>
      </table>
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail" id="goods_spec" style="display:none" >
        <tr>
          <td colspan="2" class="tableh1">特殊商品</td>
        </tr>
        #if(!$!obj)
        <tr>
          <td width="95" align="right" valign="top">F码商品：</td>
          <td class="sptable"><label>
              <input name="f_sale_type" type="radio" id="f_sale_type" value="1"  />
              是 </label>
            <label>
              <input type="radio" name="f_sale_type" id="f_sale_type" value="0" checked="checked"/>
              否 </label></td>
        </tr>
        <tr>
          <td align="right" valign="top">F码前缀：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="f_code_profix" type="text" id="f_code_profix" />
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">F码数量：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="f_code_count" type="text" id="f_code_count" />
            </span></td>
        </tr>
        <script>
		  function f_code_show(){
		    jQuery("#f_code_list").show();
			jQuery("#f_code_no_list").hide();
			jQuery("a[id=f_code_show]").hide();
			jQuery("a[id=f_code_hide]").show();
		  }
		  function f_code_hide(){
		    jQuery("#f_code_list").hide();
			jQuery("#f_code_no_list").show();
			jQuery("a[id=f_code_show]").show();
			jQuery("a[id=f_code_hide]").hide();
		  }
		  </script> 
        #if($!obj.goods_f_code)
        <tr>
          <td align="right" valign="top">F码列表<a href="javascript:void(0);" onclick="f_code_show();" id="f_code_show">[+]</a> <a id="f_code_hide" style="display:none;" href="javascript:void(0);" onclick="f_code_hide();">[-]</a>：</td>
          <td class="sptable"><div class="presell" id="f_code_no_list"><a href="javascript:void(0);" onclick="f_code_show();">点击打开F码列表信息</a></div>
            <div class="presell" id="f_code_list" style="display:none;">
              <ul>
                #foreach($f_map in $CommUtil.json2List("$!obj.goods_f_code"))
                <li><i>F码：</i><span>$f_map.get("code")</span><b>状态 : #if($f_map.get("status")==0)未使用#else已使用#end</b></li>
                #end
              </ul>
            </div></td>
        </tr>
        #end
        <tr>
          <td align="right" valign="top">预售商品：</td>
          <td class="sptable"><label>
              <input name="advance_sale_type" type="radio" id="advance_sale_type" value="1" />
              是 </label>
            <label>
              <input type="radio" name="advance_sale_type" id="advance_sale_type" value="0" checked="checked" />
              否 </label></td>
        </tr>
        <tr>
          <td align="right" valign="top">发货时间：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="advance_date" type="text" id="advance_date" value="$!CommUtil.formatShortDate($!obj.advance_date)" />
            </span></td>
        </tr>
        #else
        #set($status="")
        #if($!obj.activity_status==1 ||$!obj.activity_status==2)
        #set($status="商城促销活动")
        #end
        #if($!obj.group_buy==2)
        #set($status="团购活动")
        #end
        #if($!obj.combin_status==1)
        #set($status="组合销售活动")
        #end
        #if($!obj.order_enough_give_status==1)
        #set($status="满就送活动")
        #end
        #if($!obj.enough_reduce==1)
        #set($status="满就减活动")
        #end
        #if($!status=="")
        <tr>
          <td width="95" align="right" valign="top">F码商品：</td>
          <td class="sptable"><label>
              <input name="f_sale_type" type="radio" id="f_sale_type" value="1"  />
              是 </label>
            <label>
              <input type="radio" name="f_sale_type" id="f_sale_type" value="0" checked="checked"/>
              否 </label></td>
        </tr>
        <tr>
          <td align="right" valign="top">F码前缀：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="f_code_profix" type="text" id="f_code_profix" />
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">F码数量：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="f_code_count" type="text" id="f_code_count" />
            </span></td>
        </tr>
        <script>
                  function f_code_show(){
                    jQuery("#f_code_list").show();
                    jQuery("#f_code_no_list").hide();
                    jQuery("a[id=f_code_show]").hide();
                    jQuery("a[id=f_code_hide]").show();
                  }
                  function f_code_hide(){
                    jQuery("#f_code_list").hide();
                    jQuery("#f_code_no_list").show();
                    jQuery("a[id=f_code_show]").show();
                    jQuery("a[id=f_code_hide]").hide();
                  }
                  </script>
        <tr>
          <td align="right" valign="top">F码列表<a href="javascript:void(0);" onclick="f_code_show();" id="f_code_show">[+]</a> <a id="f_code_hide" style="display:none;" href="javascript:void(0);" onclick="f_code_hide();">[-]</a>：</td>
          <td class="sptable"><div class="presell" id="f_code_no_list"><a href="javascript:void(0);" onclick="f_code_show();">点击打开F码列表信息</a></div>
            <div class="presell" id="f_code_list" style="display:none;">
              <ul>
                #foreach($f_map in $CommUtil.json2List("$!obj.goods_f_code"))
                <li><i>F码：</i><span>$f_map.get("code")</span><b>状态 : #if($f_map.get("status")==0)未使用#else已使用#end</b></li>
                #end
              </ul>
            </div></td>
        </tr>
        <tr>
          <td align="right" valign="top">预售商品：</td>
          <td class="sptable"><label>
              <input name="advance_sale_type" type="radio" id="advance_sale_type" value="1" />
              是 </label>
            <label>
              <input type="radio" name="advance_sale_type" id="advance_sale_type" value="0" checked="checked" />
              否 </label></td>
        </tr>
        <tr>
          <td align="right" valign="top">发货时间：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="advance_date" type="text" id="advance_date" value="$!CommUtil.formatShortDate($!obj.advance_date)" />
            </span></td>
        </tr>
        #else
        <tr>
          <td align="right" valign="top"></td>
          <td class="sptable">该商品已经参加$!{status}，不可编辑为F码商品或预售商品</td>
        </tr>
        #end
        
        #end
      </table>
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail" id="goods_format" style="display:none" >
        <tr>
          <td colspan="2" class="tableh1">商品版式</td>
        </tr>
        <tr>
          <td width="95" align="right" valign="top">顶部版式：</td>
          <td class="sptable"><span>
            <select name="goods_top_format_id" id="goods_top_format_id">
              <option value="">请选择...</option>
              
              
              
              
                #foreach($gf in $gfs)
                  #if($!gf.gf_type==0)
                  
              
              
              
              <option value="$!gf.id">$!gf.gf_name</option>
              
              
              
              
                  #end
                #end
              
            
            
            
            </select>
            </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">底部版式：</td>
          <td class="sptable"><span>
            <select name="goods_bottom_format_id" id="goods_bottom_format_id">
              <option value="">请选择...</option>
              
              
              
              
                #foreach($gf in $gfs)
                  #if($!gf.gf_type==1)
                  
              
              
              
              <option value="$!gf.id">$!gf.gf_name</option>
              
              
              
              
                  #end
                #end
              
            
            
            
            </select>
            </span></td>
        </tr>
      </table>
      <table id="goods_other" style="display:none" width="100%" border="0" cellspacing="0" cellpadding="0" class="tabledetail">
        <tr>
          <td colspan="2" class="tableh1">其他信息</td>
        </tr>
        <tr>
            <td align="right" valign="middle">商品品牌：</td>
            <td>
            <div class="goods_brand_input">
              <div class="goods_brand_input_top" id="div_goods_brand">
               <input type="hidden" id="goods_brand_id" name="goods_brand_id"/>
               <label class="goods_brand_infor" name="goods_brand" id="goods_brand"></label>          
       	
               <b><a href="javascript:void(0);"></a></b>            
            </div>  
          	
            <div class="goods_brand_input_list" id="brand" style="display:none">
              <input class="list_search"  id="ibrand" type="text" />
              <ul>
                  #foreach($gb in $gbs)
                  <li bid="$!gb.id">$!gb.name</li>
                  #end
              </ul>
             </div>
             <div id="brand_none" class="goods_brand_input_list" style="display:none; float:left; height:27px; text-indent:10px; line-height:27px; width:100%;color: #A5A5A5;">
             暂无数据
             </div>            
            </div>
            </td>
          </tr>
        <tr>
          <td width="95" align="right" valign="top">商品重量：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goods_weight" type="text" id="goods_weight" value="$!obj.goods_weight" />
            </span> <span class="hui2"> 单位：千克(Kg) </span></td>
        </tr>
        <tr>
          <td align="right" valign="top">商品体积：</td>
          <td class="sptable"><span class="tabtxt1 size2">
            <input name="goods_volume" type="text" id="goods_volume" value="$!obj.goods_volume" />
            </span> <span class="hui2"> 单位：立方米(m³) </span></td>
        </tr>
        <tr>
          <td rowspan="2" align="right" valign="middle">物流运费：</td>
          <td><label>
              <input name="goods_transfee" type="radio" id="goods_transfee" value="1" checked="checked" />
              商家承担运费</label></td>
        </tr>
        <tr>
          <td><label>
              <input name="goods_transfee" type="radio" id="goods_transfee" value="0" />
              买家承担运费</label>
            <script>
			jQuery(document).ready(function(){
			   jQuery(":radio[id=transport_type]").click(function(){
				   var val=jQuery(this).val();
				   if(val==0){
				     jQuery("#transport_template_select").show();
					 jQuery("#mail_trans_fee").attr("readonly","readonly");
					 jQuery("#express_trans_fee").attr("readonly","readonly");
					 jQuery("#ems_trans_fee").attr("readonly","readonly");
				   }else{
				     jQuery("#transport_template_select").hide();
					 jQuery("#mail_trans_fee").removeAttr("readonly");
					 jQuery("#express_trans_fee").removeAttr("readonly");
					 jQuery("#ems_trans_fee").removeAttr("readonly");
				   }
				});
			   #if($!obj.transport)
			     jQuery(":radio[id=transport_type][value=0]").attr("checked","checked");
				 jQuery("#transport_template_select").show();
			   #else
			     jQuery(":radio[id=transport_type][value=1]").attr("checked","checked");
				 jQuery("#transport_template_select").hide();
			   #end
			   #if($!obj.goods_transfee==0)
			      jQuery("#buyer_transport_info").show();
			   #end
			   
			   jQuery("input[name='goods_title']").keydown(function(){
				   var vals = this.value;
				   if(vals.length > 200){
						this.value = vals.substring(0,200);				
					}
			   });
			});
			</script>
            <div id="buyer_transport_info" style=" display:none;width:80%; background:#F8F8F8; border:1px solid #CCC; margin-top:10px;padding-left:20px;">
              <ul style="line-height:30px;">
                <li>
                  <label>
                    <input name="transport_type" type="radio" id="transport_type" value="0" checked="checked" />
                    使用运费模板 </label>
                  <div id="transport_template_select" style="padding-left:30px;">
                    <input type="hidden" value="$!obj.transport.id" name="transport_id" id="transport_id" />
                    <span style="color:#06C;" id="transport_template_name">$!{obj.transport.trans_name}</span> <span style="display:block; width:70px; height:28px; text-align:center; border:#CCC solid 1px;"> <a href="javascript:void(0);" dialog_uri="$!webPath/admin/goods_transport.htm" dialog_title="选择运费模板" dialog_width="600" dialog_height="500" dialog_id="transport_template_frm">选择模板</a></span> </div>
                </li>
                <li>
                  <label>
                    <input  type="radio" name="transport_type" id="transport_type" value="1" />
                    固定运费</label>
                  平邮
                  <input name="mail_trans_fee" type="text" id="mail_trans_fee" value="$!CommUtil.null2Float($!obj.mail_trans_fee)" size="10" />
                  元,快递
                  <input name="express_trans_fee" type="text" id="express_trans_fee" value="$!CommUtil.null2Float($!obj.express_trans_fee)" size="10" />
                  元,EMS
                  <input name="ems_trans_fee" type="text" id="ems_trans_fee" value="$!CommUtil.null2Float($!obj.ems_trans_fee)" size="10" />
                  元 </li>
              </ul>
            </div></td>
        </tr>
        <tr>
          <td align="right" valign="top">商品发布：</td>
          <td class="prorelease"><span>
            <label>
              <input name="goods_status" id="goods_status" type="radio" value="0" checked="checked" />
              &nbsp;立即发布 </label>
            </span> <span>
            <label>
              <input name="goods_status" id="goods_status" type="radio" value="1" />
              &nbsp;放入仓库 </label>
            </span> <span>
            <label>
              <input name="goods_status" id="goods_status" type="radio" value="2" />
              &nbsp;定时发布 </label>
            </span> <span style="display:none;" id="publish_info">
            <input type="text" name="publish_day" id="publish_day" />
            日
            <select name="publish_hour" id="publish_hour">
              <option value="0">00</option>
              <option value="1">01</option>
              <option value="2">02</option>
              <option value="3">03</option>
              <option value="4">04</option>
              <option value="5">05</option>
              <option value="6">06</option>
              <option value="7">07</option>
              <option value="8">08</option>
              <option value="9">09</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="21">21</option>
              <option value="22">22</option>
              <option value="23">23</option>
            </select>
            时
            <select name="publish_min" id="publish_min">
              <option value="0">0分</option>
              <option value="15">15分</option>
              <option value="30">30分</option>
              <option value="45">45分</option>
            </select>
            分</span></td>
        </tr>
        <!-- 标题描述  -->
        <tr>
          <td align="right" valign="top">标题描述：</td>
          <td class="sptable">
	          <span class="tabtxt1 size1">
	            <input name="goods_title" type="text" id="goods_title" value="$!obj.goods_title" />
	          </span>
          </td>
        </tr>
        <tr>
          <td align="right" valign="top">SEO关键字：</td>
          <td class="sptable"><span class="tabtxt1 size1">
            <input name="seo_keywords" type="text" id="seo_keywords" value="$!obj.seo_keywords" />
            </span> <span class="hui2 noteswidth">SEO关键字 (keywords) 出现在商品详细页面头部的 Meta 标签中，
            用于记录本页面商品的关键字，多个关键字间请用半角逗号 "," 隔开。</span></td>
        </tr>
        <tr>
          <td align="right" valign="top">SEO描述：</td>
          <td class="sptable"><span class="texttable">
            <textarea name="seo_description" cols="" rows="" id="seo_description">$!obj.seo_description</textarea>
            </span> <span class="hui2 noteswidth">SEO描述 (Description) 出现在商品详细页面头部的 Meta 标签中， 
            用于记录本页面商品的的描述，建议80字左右，应该是该商品的最精确的简短的概述。</span></td>
        </tr>
      </table>
      <span class="submittable" style="margin-left:125px; margin-top:20px; float:left">
      <input name="" type="button" value="提交" onclick="saveForm();"/>
      <input name="goods_session" type="hidden" id="goods_session" value="$!goods_session" />
      </span>
    </form>
  </div>
</div>
</body>
</html>
